{"version":3,"file":"mailer.js","sourceRoot":"","sources":["../../src/utils/mailer.ts"],"names":[],"mappings":";;;;;;AAAA,4DAAsE;AACtE,iGAGqD;AAWrD,MAAa,MAAM;IACT,WAAW,CAAc;IACzB,MAAM,CAAe;IAE7B,YAAY,MAAoB;QAC9B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,WAAW,GAAG,oBAAU,CAAC,eAAe,CAAC;YAC5C,IAAI,EAAE,MAAM,CAAC,IAAI;YACjB,IAAI,EAAE,MAAM,CAAC,IAAI;YACjB,MAAM,EAAE,MAAM,CAAC,MAAM;YACrB,IAAI,EAAE,MAAM,CAAC,IAAI;SAClB,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,OAAqB;QACnC,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,EAAE,EAAE,cAAc,EAAE,GAAG,WAAW,EAAE,GAAG,OAAO,CAAC;QAEpE,MAAM,IAAI,GAAG,WAAW,CAAC,IAAI,IAAI,IAAA,kDAAgB,EAAC,cAAc,CAAC,CAAC;QAElE,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC;gBAC3C,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI;gBACtB,EAAE;gBACF,EAAE,EAAE,yBAAyB;gBAC7B,OAAO;gBACP,IAAI,EACF,WAAW,CAAC,IAAI,IAAI,gDAAgD;gBACtE,IAAI;gBACJ,GAAG,WAAW;aACf,CAAC,CAAC;YAEH,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;YAChD,IAAI,EAAE,EAAE,CAAC;gBACP,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,KAAK,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACxE,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAE,KAAK,CAAC,CAAC;YAC7C,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,KAAK,CAAC,gBAAgB;QACpB,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;YAChC,OAAO,CAAC,GAAG,CAAC,sCAAsC,CAAC,CAAC;YACpD,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC,CAAC;YACxD,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;CACF;AAnDD,wBAmDC;AAeY,QAAA,YAAY,GAAiB;IACxC,IAAI,EAAE,oBAAoB;IAC1B,IAAI,EAAE,GAAG;IACT,MAAM,EAAE,KAAK,EAAE,eAAe;IAC9B,IAAI,EAAE;QACJ,IAAI,EAAE,wBAAwB,EAAE,uBAAuB;QACvD,IAAI,EAAE,kBAAkB,EAAE,iCAAiC;KAC5D;IACD,0BAA0B;IAC1B,kDAAkD;IAClD,iBAAiB;IACjB,UAAU;IACV,qCAAqC;IACrC,iCAAiC;IACjC,KAAK;IACL,IAAI,EAAE,qCAAqC,EAAE,kBAAkB;CAChE,CAAC;AAEF,uBAAuB;AACV,QAAA,MAAM,GAAG,IAAI,MAAM,CAAC,oBAAY,CAAC,CAAC","sourcesContent":["import nodemailer, { Transporter, SendMailOptions } from \"nodemailer\";\r\nimport {\r\n  getEmailTemplate,\r\n  EmailTemplateParams,\r\n} from \"../template/actionNotificationEmailTemplate\";\r\n\r\nexport interface EmailOptions extends Partial<SendMailOptions> {\r\n  to: string;\r\n  subject: string;\r\n  cc?: string | string[]; // Add CC support\r\n  templateParams?: EmailTemplateParams;\r\n}\r\n\r\n\r\n\r\nexport class Mailer {\r\n  private transporter: Transporter;\r\n  private config: MailerConfig;\r\n\r\n  constructor(config: MailerConfig) {\r\n    this.config = config;\r\n    this.transporter = nodemailer.createTransport({\r\n      host: config.host,\r\n      port: config.port,\r\n      secure: config.secure,\r\n      auth: config.auth,\r\n    });\r\n  }\r\n\r\n  async sendEmail(options: EmailOptions): Promise<void> {\r\n    const { to, subject, cc, templateParams, ...mailOptions } = options;\r\n\r\n    const html = mailOptions.html || getEmailTemplate(templateParams);\r\n\r\n    try {\r\n      const info = await this.transporter.sendMail({\r\n        from: this.config.from,\r\n        to,\r\n        cc, // Add CC to mail options\r\n        subject,\r\n        text:\r\n          mailOptions.text || \"Please enable HTML to view this email content.\",\r\n        html,\r\n        ...mailOptions,\r\n      });\r\n\r\n      console.log(\"Message sent: %s\", info.messageId);\r\n      if (cc) {\r\n        console.log(\"CC recipients:\", Array.isArray(cc) ? cc.join(', ') : cc);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error sending email:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async verifyConnection(): Promise<boolean> {\r\n    try {\r\n      await this.transporter.verify();\r\n      console.log(\"Server is ready to take our messages\");\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Connection verification failed:\", error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\nexport interface MailerConfig {\r\n  host: string;\r\n  port: number;\r\n  secure: boolean;\r\n  auth: {\r\n    user: string;\r\n    pass: string;\r\n  };\r\n  from: string;\r\n  tls?: {\r\n    ciphers?: string;\r\n  };\r\n}\r\n\r\nexport const mailerConfig: MailerConfig = {\r\n  host: \"smtp.office365.com\",\r\n  port: 587,\r\n  secure: false, // use STARTTLS\r\n  auth: {\r\n    user: \"info@alghazalgroup.com\", // your Office365 email\r\n    pass: \"ftftxxppxyjppggf\", // ðŸ”‘ your Office365 App Password\r\n  },\r\n  // host: \"smtp.gmail.com\",\r\n  // port: parseInt(process.env.SMTP_PORT || '587'),\r\n  // secure: false,\r\n  // auth: {\r\n  //   user: \"ajmalshahan23@gmail.com\",\r\n  //   pass: \"wgmt bvtx wllu nzuz\",\r\n  // },\r\n  from: '\"Alghazal\" <info@alghazalgroup.com>', // must match user\r\n};\r\n\r\n// âœ… Singleton instance\r\nexport const mailer = new Mailer(mailerConfig);\r\n"]}