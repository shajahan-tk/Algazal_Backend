{"version":3,"file":"lpoModel.js","sourceRoot":"","sources":["../../src/models/lpoModel.ts"],"names":[],"mappings":";;;AAAA,uCAA0D;AAgC1D,MAAM,aAAa,GAAG,IAAI,iBAAM,CAAW;IACzC,WAAW,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;IAC7C,QAAQ,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE;IAClD,SAAS,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE;IACnD,UAAU,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE;CACrD,CAAC,CAAC;AAEH,MAAM,SAAS,GAAG,IAAI,iBAAM,CAC1B;IACE,OAAO,EAAE;QACP,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,GAAG,EAAE,SAAS;QACd,QAAQ,EAAE,IAAI;KACf;IACD,SAAS,EAAE;QACT,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACf;IACD,OAAO,EAAE;QACP,IAAI,EAAE,IAAI;QACV,QAAQ,EAAE,IAAI;KACf;IACD,QAAQ,EAAE;QACR,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;KACf;IACD,KAAK,EAAE,CAAC,aAAa,CAAC;IACtB,SAAS,EAAE;QACT;YACE,GAAG,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;YACrC,GAAG,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;YACrC,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;YACtC,QAAQ,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;YAC1C,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;SACvC;KACF;IACD,WAAW,EAAE;QACX,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,IAAI;QACd,GAAG,EAAE,CAAC;KACP;IACD,SAAS,EAAE;QACT,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,GAAG,EAAE,MAAM;QACX,QAAQ,EAAE,IAAI;KACf;CACF,EACD,EAAE,UAAU,EAAE,IAAI,EAAE,CACrB,CAAC;AAEF,4CAA4C;AAC5C,SAAS,CAAC,GAAG,CAAO,MAAM,EAAE,UAAU,IAAI;IACxC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,CAAC,GAAG,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC;IAC9E,IAAI,EAAE,CAAC;AACT,CAAC,CAAC,CAAC;AAEH,UAAU;AAEV,SAAS,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;AAClC,SAAS,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC;AACjC,SAAS,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC;AAEnB,QAAA,GAAG,GAAG,IAAA,gBAAK,EAAO,KAAK,EAAE,SAAS,CAAC,CAAC","sourcesContent":["import { Document, Schema, model, Types } from \"mongoose\";\r\nimport { IProject } from \"./projectModel\";\r\nimport { IUser } from \"./userModel\";\r\n\r\ninterface ILPOItem {\r\n  description: string;\r\n  quantity: number;\r\n  unitPrice: number;\r\n  totalPrice: number;\r\n}\r\n\r\ninterface ILPODocument {\r\n  url: string;\r\n  key: string;\r\n  name: string;\r\n  mimetype: string;\r\n  size: number;\r\n}\r\n\r\nexport interface ILPO extends Document {\r\n  project: Types.ObjectId | IProject;\r\n  lpoNumber: string;\r\n  lpoDate: Date;\r\n  supplier: string;\r\n  items: ILPOItem[];\r\n  documents: ILPODocument[];\r\n  totalAmount: number;\r\n  createdBy: Types.ObjectId | IUser;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nconst lpoItemSchema = new Schema<ILPOItem>({\r\n  description: { type: String, required: true },\r\n  quantity: { type: Number, required: true, min: 0 },\r\n  unitPrice: { type: Number, required: true, min: 0 },\r\n  totalPrice: { type: Number, required: true, min: 0 },\r\n});\r\n\r\nconst lpoSchema = new Schema<ILPO>(\r\n  {\r\n    project: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"Project\",\r\n      required: true,\r\n    },\r\n    lpoNumber: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    lpoDate: {\r\n      type: Date,\r\n      required: true,\r\n    },\r\n    supplier: {\r\n      type: String,\r\n      required: true,\r\n    },\r\n    items: [lpoItemSchema],\r\n    documents: [\r\n      {\r\n        url: { type: String, required: true },\r\n        key: { type: String, required: true },\r\n        name: { type: String, required: true },\r\n        mimetype: { type: String, required: true },\r\n        size: { type: Number, required: true },\r\n      },\r\n    ],\r\n    totalAmount: {\r\n      type: Number,\r\n      required: true,\r\n      min: 0,\r\n    },\r\n    createdBy: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"User\",\r\n      required: true,\r\n    },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\n// Auto-calculate total amount before saving\r\nlpoSchema.pre<ILPO>(\"save\", function (next) {\r\n  this.totalAmount = this.items.reduce((sum, item) => sum + item.totalPrice, 0);\r\n  next();\r\n});\r\n\r\n// Indexes\r\n\r\nlpoSchema.index({ lpoNumber: 1 });\r\nlpoSchema.index({ supplier: 1 });\r\nlpoSchema.index({ lpoDate: 1 });\r\n\r\nexport const LPO = model<ILPO>(\"LPO\", lpoSchema);\r\n"]}