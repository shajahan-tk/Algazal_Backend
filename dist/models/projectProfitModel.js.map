{"version":3,"file":"projectProfitModel.js","sourceRoot":"","sources":["../../src/models/projectProfitModel.ts"],"names":[],"mappings":"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","sourcesContent":["import { Document, Schema, model, Types } from \"mongoose\";\r\n\r\nexport interface IProjectProfit extends Document {\r\n  project: Types.ObjectId; // Reference to Project\r\n  \r\n  // Denormalized data for historical accuracy\r\n  projectName: string;\r\n  projectNumber: string;\r\n  clientName: string;\r\n  location: string;\r\n  building: string;\r\n  apartmentNumber: string;\r\n  \r\n  // LPO details - only store reference, not the number\r\n  lpoId?: Types.ObjectId;\r\n  \r\n  // Report period\r\n  reportMonth: Date;\r\n  reportPeriodStart: Date;\r\n  reportPeriodEnd: Date;\r\n  \r\n  // Financial data\r\n  budget: number;\r\n  expenses: number;\r\n  profit: number;\r\n  \r\n  description?: string;\r\n  attachments: Types.DocumentArray<IAttachment>;\r\n  createdBy: Types.ObjectId;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nexport interface IAttachment extends Document {\r\n  fileName: string;\r\n  fileType: string;\r\n  filePath: string;\r\n}\r\n\r\nconst attachmentSchema = new Schema<IAttachment>({\r\n  fileName: { type: String, required: true },\r\n  fileType: { type: String, required: true },\r\n  filePath: { type: String, required: true },\r\n});\r\n\r\nconst projectProfitSchema = new Schema<IProjectProfit>(\r\n  {\r\n    project: { \r\n      type: Schema.Types.ObjectId, \r\n      ref: \"Project\", \r\n      required: true \r\n    },\r\n    \r\n    // Denormalized fields (stored for historical accuracy)\r\n    projectName: { type: String, required: true },\r\n    projectNumber: { type: String, required: true },\r\n    clientName: { type: String, required: true },\r\n    location: { type: String, required: true },\r\n    building: { type: String, required: true },\r\n    apartmentNumber: { type: String, required: true },\r\n    \r\n    // LPO details - only store reference ID\r\n    lpoId: { type: Schema.Types.ObjectId, ref: \"LPO\" },\r\n    \r\n    // Report period\r\n    reportMonth: { type: Date, required: true },\r\n    reportPeriodStart: { type: Date, required: true },\r\n    reportPeriodEnd: { type: Date, required: true },\r\n    \r\n    // Financial data\r\n    budget: { type: Number, required: true, min: 0 },\r\n    expenses: { type: Number, required: true, min: 0, default: 0 },\r\n    profit: { type: Number, required: true, default: 0 },\r\n    \r\n    description: { type: String },\r\n    attachments: [attachmentSchema],\r\n    createdBy: { type: Schema.Types.ObjectId, ref: \"User\", required: true },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\n// Auto-calculate profit before saving\r\nprojectProfitSchema.pre<IProjectProfit>(\"save\", function (next) {\r\n  this.profit = this.budget - this.expenses;\r\n  next();\r\n});\r\n\r\n// Indexes\r\nprojectProfitSchema.index({ project: 1, reportMonth: 1 });\r\nprojectProfitSchema.index({ projectName: 1 });\r\nprojectProfitSchema.index({ reportMonth: 1 });\r\nprojectProfitSchema.index({ profit: 1 });\r\nprojectProfitSchema.index({ createdBy: 1 });\r\nprojectProfitSchema.index({ lpoId: 1 }); // Index for LPO reference\r\n\r\nexport const ProjectProfit = model<IProjectProfit>(\"ProjectProfit\", projectProfitSchema);"]}