{"version":3,"file":"expenseModel.js","sourceRoot":"","sources":["../../src/models/expenseModel.ts"],"names":[],"mappings":"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","sourcesContent":["import { Document, Schema, model, Types } from \"mongoose\";\r\nimport { IProject } from \"./projectModel\";\r\nimport { IUser } from \"./userModel\";\r\n\r\nexport interface IMaterialItem {\r\n  description: string;\r\n  date: Date;\r\n  invoiceNo: string;\r\n  amount: number;\r\n  _id?: Types.ObjectId;\r\n  supplierName?: string;\r\n  supplierMobile?: string;\r\n  supplierEmail?: string;\r\n  documentUrl?: string;\r\n  documentKey?: string;\r\n}\r\n\r\nexport interface IMiscellaneousExpense {\r\n  description: string;\r\n  quantity: number;\r\n  unitPrice: number;\r\n  total: number;\r\n  _id?: Types.ObjectId;\r\n}\r\n\r\nexport interface IWorkerLabor {\r\n  user: Types.ObjectId | IUser;\r\n  daysPresent: number;\r\n  dailySalary: number;\r\n  totalSalary: number;\r\n  _id?: Types.ObjectId;\r\n}\r\n\r\nexport interface IDriverLabor {\r\n  user: Types.ObjectId | IUser;\r\n  daysPresent: number;\r\n  dailySalary: number;\r\n  totalSalary: number;\r\n}\r\n\r\nexport interface IExpense extends Document {\r\n  project: Types.ObjectId | IProject;\r\n  materials: IMaterialItem[];\r\n  totalMaterialCost: number;\r\n  miscellaneous: IMiscellaneousExpense[];\r\n  totalMiscellaneousCost: number;\r\n  laborDetails: {\r\n    workers: IWorkerLabor[];\r\n    driver: IDriverLabor;\r\n    totalLaborCost: number;\r\n  };\r\n  createdBy: Types.ObjectId | IUser;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nconst expenseSchema = new Schema<IExpense>(\r\n  {\r\n    project: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"Project\",\r\n      required: true,\r\n    },\r\n    materials: [\r\n      {\r\n        description: { type: String, required: true },\r\n        date: { type: Date, required: true, default: Date.now },\r\n        invoiceNo: { type: String, required: true },\r\n        amount: { type: Number, required: true, min: 0 },\r\n        supplierName: { type: String, required: false },\r\n        supplierMobile: { type: String, required: false },\r\n        supplierEmail: { type: String, required: false },\r\n        documentUrl: { type: String, required: false },\r\n        documentKey: { type: String, required: false },\r\n      },\r\n    ],\r\n    totalMaterialCost: { type: Number, default: 0 },\r\n    miscellaneous: [\r\n      {\r\n        description: { type: String, required: true },\r\n        quantity: { type: Number, required: true, min: 0 },\r\n        unitPrice: { type: Number, required: true, min: 0 },\r\n        total: { type: Number, required: true, min: 0 },\r\n      },\r\n    ],\r\n    totalMiscellaneousCost: { type: Number, default: 0 },\r\n    laborDetails: {\r\n      workers: [\r\n        {\r\n          user: { type: Schema.Types.ObjectId, ref: \"User\", required: true },\r\n          daysPresent: { type: Number, required: true, min: 0 },\r\n          dailySalary: { type: Number, required: true, min: 0 },\r\n          totalSalary: { type: Number, required: true, min: 0 },\r\n        },\r\n      ],\r\n      driver: {\r\n        user: { type: Schema.Types.ObjectId, ref: \"User\", required: true },\r\n        daysPresent: { type: Number, required: true, min: 0 },\r\n        dailySalary: { type: Number, required: true, min: 0 },\r\n        totalSalary: { type: Number, required: true, min: 0 },\r\n      },\r\n      totalLaborCost: { type: Number, default: 0 },\r\n    },\r\n    createdBy: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"User\",\r\n      required: true,\r\n    },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nexpenseSchema.pre<IExpense>(\"save\", function (next) {\r\n  this.totalMaterialCost = this.materials.reduce(\r\n    (sum, material) => sum + material.amount,\r\n    0\r\n  );\r\n\r\n  this.totalMiscellaneousCost = this.miscellaneous.reduce(\r\n    (sum, misc) => sum + misc.total,\r\n    0\r\n  );\r\n\r\n  const workersTotal = this.laborDetails.workers.reduce(\r\n    (sum, worker) => sum + worker.totalSalary,\r\n    0\r\n  );\r\n  const driverTotal = this.laborDetails.driver.totalSalary;\r\n  this.laborDetails.totalLaborCost = workersTotal + driverTotal;\r\n\r\n  next();\r\n});\r\n\r\nexport const Expense = model<IExpense>(\"Expense\", expenseSchema);\r\n"]}