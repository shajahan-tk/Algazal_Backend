{"version":3,"file":"quotationController.js","sourceRoot":"","sources":["../../src/controllers/quotationController.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response } from \"express\";\r\nimport { asyncHandler } from \"../utils/asyncHandler\";\r\nimport { ApiResponse } from \"../utils/apiHandlerHelpers\";\r\nimport { ApiError } from \"../utils/apiHandlerHelpers\";\r\nimport { Quotation } from \"../models/quotationModel\";\r\nimport { IProject, Project } from \"../models/projectModel\";\r\nimport { Estimation } from \"../models/estimationModel\";\r\nimport { uploadItemImage, deleteFileFromS3 } from \"../utils/uploadConf\";\r\nimport puppeteer from \"puppeteer\";\r\nimport { generateRelatedDocumentNumber } from \"../utils/documentNumbers\";\r\nimport { IUser } from \"../models/userModel\";\r\nimport { IClient } from \"../models/clientModel\";\r\n\r\nexport const createQuotation = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    // Debugging logs\r\n    console.log(\"Request body:\", req.body);\r\n    console.log(\"Request files:\", req.files);\r\n\r\n    if (!req.files || !Array.isArray(req.files)) {\r\n      throw new ApiError(400, \"No files were uploaded\");\r\n    }\r\n\r\n    // Parse the JSON data from form-data\r\n    let jsonData;\r\n    try {\r\n      jsonData = JSON.parse(req.body.data);\r\n    } catch (error) {\r\n      throw new ApiError(400, \"Invalid JSON data format\");\r\n    }\r\n\r\n    const {\r\n      project: projectId,\r\n      validUntil,\r\n      scopeOfWork = [],\r\n      items = [],\r\n      termsAndConditions = [],\r\n      vatPercentage = 5,\r\n    } = jsonData;\r\n\r\n    // Validate items is an array\r\n    if (!Array.isArray(items)) {\r\n      throw new ApiError(400, \"Items must be an array\");\r\n    }\r\n\r\n    // Check for existing quotation\r\n    const exists = await Quotation.findOne({ project: projectId });\r\n    if (exists) throw new ApiError(400, \"Project already has a quotation\");\r\n\r\n    const estimation = await Estimation.findOne({ project: projectId });\r\n    const estimationId = estimation?._id;\r\n\r\n    // Process items with their corresponding files\r\n    const processedItems = await Promise.all(\r\n      items.map(async (item: any, index: number) => {\r\n        // Find the image file for this item using the correct fieldname pattern\r\n        const imageFile = (req.files as Express.Multer.File[]).find(\r\n          (f) => f.fieldname === `items[${index}][image]`\r\n        );\r\n\r\n        if (imageFile) {\r\n          console.log(`Processing image for item ${index}:`, imageFile);\r\n          const uploadResult = await uploadItemImage(imageFile);\r\n          if (uploadResult.uploadData) {\r\n            item.image = uploadResult.uploadData;\r\n          }\r\n        } else {\r\n          console.log(`No image found for item ${index}`);\r\n        }\r\n\r\n        item.totalPrice = item.quantity * item.unitPrice;\r\n        return item;\r\n      })\r\n    );\r\n\r\n    // Calculate financial totals\r\n    const subtotal = processedItems.reduce(\r\n      (sum, item) => sum + item.totalPrice,\r\n      0\r\n    );\r\n    const vatAmount = subtotal * (vatPercentage / 100);\r\n    const total = subtotal + vatAmount;\r\n\r\n    const quotation = await Quotation.create({\r\n      project: projectId,\r\n      estimation: estimationId,\r\n      quotationNumber: await generateRelatedDocumentNumber(projectId, \"QTN\"),\r\n      date: new Date(),\r\n      validUntil: new Date(validUntil),\r\n      scopeOfWork,\r\n      items: processedItems,\r\n      termsAndConditions,\r\n      vatPercentage,\r\n      subtotal,\r\n      vatAmount,\r\n      netAmount: total,\r\n      preparedBy: req.user?.userId,\r\n    });\r\n\r\n    await Project.findByIdAndUpdate(projectId, { status: \"quotation_sent\" });\r\n\r\n    res.status(201).json(new ApiResponse(201, quotation, \"Quotation created\"));\r\n  }\r\n);\r\n\r\nexport const getQuotationByProject = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    const { projectId } = req.params;\r\n    const quotation = await Quotation.findOne({ project: projectId })\r\n      .populate(\"project\", \"projectName\")\r\n      .populate(\"preparedBy\", \"firstName lastName\");\r\n\r\n    if (!quotation) throw new ApiError(404, \"Quotation not found\");\r\n    res\r\n      .status(200)\r\n      .json(new ApiResponse(200, quotation, \"Quotation retrieved\"));\r\n  }\r\n);\r\n\r\nexport const updateQuotation = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    // Debugging logs\r\n    console.log(\"Request body:\", req.body);\r\n    console.log(\"Request files:\", req.files);\r\n\r\n    if (!req.files || !Array.isArray(req.files)) {\r\n      throw new ApiError(400, \"No files were uploaded\");\r\n    }\r\n\r\n    // Parse the JSON data from form-data\r\n    let jsonData;\r\n    try {\r\n      jsonData = JSON.parse(req.body.data);\r\n    } catch (error) {\r\n      throw new ApiError(400, \"Invalid JSON data format\");\r\n    }\r\n\r\n    const { id } = req.params;\r\n    const {\r\n      items = [],\r\n      validUntil,\r\n      scopeOfWork,\r\n      termsAndConditions,\r\n      vatPercentage,\r\n    } = jsonData;\r\n\r\n    // Validate items is an array\r\n    if (!Array.isArray(items)) {\r\n      throw new ApiError(400, \"Items must be an array\");\r\n    }\r\n\r\n    const quotation = await Quotation.findById(id);\r\n    if (!quotation) throw new ApiError(404, \"Quotation not found\");\r\n\r\n    // Process items with their corresponding files\r\n    const processedItems = await Promise.all(\r\n      items.map(async (item: any, index: number) => {\r\n        // Find the image file for this item using the correct fieldname pattern\r\n        const imageFile = (req.files as Express.Multer.File[]).find(\r\n          (f) => f.fieldname === `items[${index}][image]`\r\n        );\r\n\r\n        // If new image is uploaded\r\n        if (imageFile) {\r\n          console.log(`Processing image for item ${index}:`, imageFile);\r\n          \r\n          // Delete old image if it exists\r\n          if (item.image?.key) {\r\n            await deleteFileFromS3(item.image.key);\r\n          }\r\n\r\n          // Upload new image\r\n          const uploadResult = await uploadItemImage(imageFile);\r\n          if (uploadResult.uploadData) {\r\n            item.image = uploadResult.uploadData;\r\n          }\r\n        } else if (item.image && typeof item.image === 'object') {\r\n          // Keep existing image if no new one was uploaded\r\n          item.image = item.image;\r\n        } else {\r\n          // No image for this item\r\n          item.image = undefined;\r\n        }\r\n\r\n        // Calculate total price\r\n        item.totalPrice = item.quantity * item.unitPrice;\r\n        return item;\r\n      })\r\n    );\r\n\r\n    // Calculate financial totals\r\n    const subtotal = processedItems.reduce(\r\n      (sum, item) => sum + item.totalPrice,\r\n      0\r\n    );\r\n    const vatAmount = subtotal * ((vatPercentage || quotation.vatPercentage) / 100);\r\n    const total = subtotal + vatAmount;\r\n\r\n    // Update quotation fields\r\n    quotation.items = processedItems;\r\n    if (validUntil) quotation.validUntil = new Date(validUntil);\r\n    if (scopeOfWork) quotation.scopeOfWork = scopeOfWork;\r\n    if (termsAndConditions) quotation.termsAndConditions = termsAndConditions;\r\n    if (vatPercentage) quotation.vatPercentage = vatPercentage;\r\n    quotation.subtotal = subtotal;\r\n    quotation.vatAmount = vatAmount;\r\n    quotation.netAmount = total;\r\n\r\n    await quotation.save();\r\n\r\n    res.status(200).json(new ApiResponse(200, quotation, \"Quotation updated\"));\r\n  }\r\n);\r\n\r\nexport const approveQuotation = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    const { id } = req.params;\r\n    const { isApproved, comment } = req.body;\r\n\r\n    const quotation = await Quotation.findByIdAndUpdate(\r\n      id,\r\n      {\r\n        isApproved,\r\n        approvalComment: comment,\r\n        approvedBy: req.user?.userId,\r\n      },\r\n      { new: true }\r\n    );\r\n\r\n    await Project.findByIdAndUpdate(quotation?.project, {\r\n      status: isApproved ? \"quotation_approved\" : \"quotation_rejected\",\r\n    });\r\n\r\n    res\r\n      .status(200)\r\n      .json(\r\n        new ApiResponse(\r\n          200,\r\n          quotation,\r\n          `Quotation ${isApproved ? \"approved\" : \"rejected\"}`\r\n        )\r\n      );\r\n  }\r\n);\r\n\r\nexport const deleteQuotation = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    const { id } = req.params;\r\n    const quotation = await Quotation.findByIdAndDelete(id);\r\n\r\n    if (!quotation) throw new ApiError(404, \"Quotation not found\");\r\n\r\n    await Promise.all(\r\n      quotation.items.map((item) =>\r\n        item.image?.key ? deleteFileFromS3(item.image.key) : Promise.resolve()\r\n      )\r\n    );\r\n\r\n    await Project.findByIdAndUpdate(quotation.project, {\r\n      status: \"estimation_prepared\",\r\n    });\r\n\r\n    res.status(200).json(new ApiResponse(200, null, \"Quotation deleted\"));\r\n  }\r\n);\r\n\r\n\r\nexport const generateQuotationPdf = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    const { id } = req.params;\r\n\r\n    const quotation = await Quotation.findById(id)\r\n      .populate<{ project: IProject & { client: IClient } }>({\r\n        path: \"project\",\r\n        select: \"projectName client siteAddress location building apartmentNumber\",\r\n        populate: {\r\n          path: \"client\",\r\n          select: \"clientName clientAddress mobileNumber telephoneNumber email\",\r\n        },\r\n      })\r\n      .populate<{ preparedBy: IUser }>(\r\n        \"preparedBy\",\r\n        \"firstName lastName phoneNumbers\"\r\n      );\r\n\r\n    if (!quotation) throw new ApiError(404, \"Quotation not found\");\r\n\r\n    if (!quotation.project || typeof quotation.project !== \"object\" || !(\"client\" in quotation.project)) {\r\n      throw new ApiError(400, \"Client information not found\");\r\n    }\r\n\r\n    const client = quotation.project.client as IClient;\r\n    const preparedBy = quotation.preparedBy as IUser;\r\n    const project = quotation.project;\r\n    const site = `${project.location} ${project.building} ${project.apartmentNumber}`;\r\n\r\n    // Calculate totals\r\n    const subtotal = quotation.items.reduce((sum, item) => sum + item.totalPrice, 0);\r\n    const vatAmount = subtotal * (quotation.vatPercentage / 100);\r\n    const netAmount = subtotal + vatAmount;\r\n\r\n    const formatDate = (date: Date) => {\r\n      return date ? new Date(date).toLocaleDateString(\"en-GB\", {\r\n        day: \"2-digit\",\r\n        month: \"short\",\r\n        year: \"numeric\",\r\n      }) : \"\";\r\n    };\r\n    const getDaysRemaining = (validUntil: Date) => {\r\n      if (!validUntil) return \"N/A\";\r\n      const today = new Date();\r\n      const validDate = new Date(validUntil);\r\n      const timeDiff = validDate.getTime() - today.getTime();\r\n      const daysRemaining = Math.ceil(timeDiff / (1000 * 3600 * 24));\r\n      return daysRemaining > 0 ? `${daysRemaining} days` : \"Expired\";\r\n    };\r\n\r\n  let htmlContent = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n  <style type=\"text/css\">\r\n    @page {\r\n      size: A4;\r\n      margin: 1cm;\r\n    }\r\n    body {\r\n      font-family: 'Arial', sans-serif;\r\n      font-size: 10pt;\r\n      line-height: 1.4;\r\n      color: #333;\r\n      margin: 0;\r\n      padding: 0;\r\n      position: relative;\r\n      min-height: 100vh;\r\n    }\r\n    .header {\r\n      display: flex;\r\n      align-items: center;\r\n      margin-bottom: 15px;\r\n    }\r\n    .logo {\r\n      height: 50px;\r\n      width: auto;\r\n      margin-right: 20px;\r\n    }\r\n    .header-content {\r\n      flex-grow: 1;\r\n    }\r\n    .document-title {\r\n      font-size: 14pt;\r\n      font-weight: bold;\r\n      margin: 5px 0;\r\n      text-align: center;\r\n      color: #000;\r\n    }\r\n    .client-info-container {\r\n      display: flex;\r\n      margin-bottom: 20px;\r\n    }\r\n    .client-info {\r\n      flex: 1;\r\n      padding: 10px;\r\n      margin-right: 20px;\r\n    }\r\n    .quotation-info {\r\n      width: 250px;\r\n    }\r\n    .quotation-details {\r\n      width: 100%;\r\n      border-collapse: collapse;\r\n    }\r\n    .quotation-details tr:not(:last-child) {\r\n      border-bottom: 1px solid #eee;\r\n    }\r\n    .quotation-details td {\r\n      padding: 8px 10px;\r\n      vertical-align: top;\r\n    }\r\n    .quotation-details td:first-child {\r\n      font-weight: bold;\r\n      width: 40%;\r\n      color: #555;\r\n    }\r\n    .section {\r\n      margin-bottom: 15px;\r\n      page-break-inside: avoid;\r\n    }\r\n    .section-title {\r\n      font-size: 11pt;\r\n      font-weight: bold;\r\n      padding: 5px 0;\r\n      margin: 10px 0 5px 0;\r\n      border-bottom: 1px solid #ddd;\r\n    }\r\n    table {\r\n      width: 100%;\r\n      border-collapse: collapse;\r\n      margin-bottom: 15px;\r\n      page-break-inside: avoid;\r\n    }\r\n    th {\r\n      background-color: #94d7f4;\r\n      color: #000;\r\n      font-weight: bold;\r\n      padding: 6px 8px;\r\n      text-align: left;\r\n      border: 1px solid #ddd;\r\n    }\r\n    td {\r\n      padding: 6px 8px;\r\n      border: 1px solid #ddd;\r\n      vertical-align: top;\r\n    }\r\n    .amount-summary {\r\n      margin-top: 10px;\r\n      width: 100%;\r\n      text-align: right;\r\n    }\r\n    .amount-summary-row {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      margin-bottom: 5px;\r\n    }\r\n    .amount-label {\r\n      width: 150px;\r\n      font-weight: bold;\r\n      text-align: right;\r\n      padding-right: 10px;\r\n    }\r\n    .amount-value {\r\n      width: 100px;\r\n      text-align: right;\r\n    }\r\n    .net-amount-row {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      background-color: #94d7f4;\r\n      color: #000;\r\n      font-weight: bold;\r\n      font-size: 11pt;\r\n      margin-top: 5px;\r\n      padding: 5px 0;\r\n      border-top: 1px solid #333;\r\n    }\r\n    .terms-box {\r\n      border: 1px solid #000;\r\n      padding: 10px;\r\n      margin-top: 15px;\r\n      display: inline-block;\r\n      width: auto;\r\n      min-width: 50%;\r\n    }\r\n    .footer-container {\r\n      position: absolute;\r\n      bottom: 0;\r\n      width: 100%;\r\n    }\r\n    .tagline {\r\n      text-align: center;\r\n      font-weight: bold;\r\n      font-size: 12pt;\r\n      margin: 20px 0 10px 0;\r\n      color: #333;\r\n    }\r\n    .footer {\r\n      font-size: 9pt;\r\n      color: #777;\r\n      text-align: center;\r\n      border-top: 1px solid #ddd;\r\n      padding-top: 10px;\r\n      margin-top: 10px;\r\n    }\r\n    .prepared-by {\r\n      margin-top: 30px;\r\n      padding-top: 15px;\r\n      border-top: 1px solid #ddd;\r\n      margin-bottom: 60px;\r\n    }\r\n    .prepared-by-name {\r\n      font-weight: bold;\r\n      margin-top: 20px;\r\n    }\r\n    .prepared-by-title {\r\n      font-size: 9pt;\r\n      color: #777;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"header\">\r\n    <img class=\"logo\" src=\"https://krishnadas-test-1.s3.ap-south-1.amazonaws.com/sample-spmc/logo+(1).png\" alt=\"Company Logo\">\r\n    <div class=\"header-content\">\r\n      <div class=\"document-title\">QUOTE</div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"client-info-container\">\r\n    <div class=\"client-info\">\r\n      <p><strong>Client:</strong> ${client.clientName || \"N/A\"}</p>\r\n      <p><strong>Address:</strong> ${client.clientAddress || \"N/A\"}</p>\r\n      <p><strong>Contact:</strong> ${client.mobileNumber || client.telephoneNumber || \"N/A\"}</p>\r\n      <p><strong>Email:</strong> ${client.email || \"N/A\"}</p>\r\n      <p><strong>Site:</strong> ${site}</p>\r\n      <p><strong>Subject:</strong> ${project.projectName || \"N/A\"}</p>\r\n    </div>\r\n\r\n    <div class=\"quotation-info\">\r\n      <table class=\"quotation-details\">\r\n        <tr>\r\n          <td>Quotation #:</td>\r\n          <td>${quotation.quotationNumber}</td>\r\n        </tr>\r\n        <tr>\r\n          <td>Date:</td>\r\n          <td>${formatDate(quotation.date)}</td>\r\n        </tr>\r\n        <tr>\r\n          <td>Valid Until:</td>\r\n          <td>${getDaysRemaining(quotation.validUntil)}</td>\r\n        </tr>\r\n      </table>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"section\">\r\n    <div class=\"section-title\">ITEMS</div>\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th width=\"5%\">No.</th>\r\n          <th width=\"35%\">Description</th>\r\n          <th width=\"10%\">UOM</th>\r\n          <th width=\"15%\">Image</th>\r\n          <th width=\"10%\">Qty</th>\r\n          <th width=\"15%\">Unit Price (AED)</th>\r\n          <th width=\"10%\" class=\"text-right\">Total (AED)</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        ${quotation.items.map((item, index) => `\r\n          <tr>\r\n            <td class=\"text-center\">${index + 1}</td>\r\n            <td>${item.description}</td>\r\n            <td class=\"text-center\">${item.uom || \"NOS\"}</td>\r\n            <td class=\"text-center\">\r\n              ${item.image?.url ? `<img src=\"${item.image.url}\" style=\"max-height: 50px; max-width: 100px;\"/>` : \"\"}\r\n            </td>\r\n            <td class=\"text-center\">${item.quantity.toFixed(2)}</td>\r\n            <td class=\"text-right\">${item.unitPrice.toFixed(2)}</td>\r\n            <td class=\"text-right\">${item.totalPrice.toFixed(2)}</td>\r\n          </tr>\r\n        `).join(\"\")}\r\n      </tbody>\r\n    </table>\r\n\r\n    <div class=\"amount-summary\">\r\n      <div class=\"amount-summary-row\">\r\n        <div class=\"amount-label\">SUBTOTAL:</div>\r\n        <div class=\"amount-value\">${subtotal.toFixed(2)} AED</div>\r\n      </div>\r\n      <div class=\"amount-summary-row\">\r\n        <div class=\"amount-label\">VAT ${quotation.vatPercentage}%:</div>\r\n        <div class=\"amount-value\">${vatAmount.toFixed(2)} AED</div>\r\n      </div>\r\n      <div class=\"net-amount-row\">\r\n        <div class=\"amount-label\">NET AMOUNT:</div>\r\n        <div class=\"amount-value\">${netAmount.toFixed(2)} AED</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  ${quotation.termsAndConditions.length > 0 ? `\r\n  <div class=\"section\">\r\n    <div class=\"section-title\">TERMS & CONDITIONS</div>\r\n    <div class=\"terms-box\">\r\n      <ol>\r\n        ${quotation.termsAndConditions.map(term => `<li>${term}</li>`).join(\"\")}\r\n      </ol>\r\n    </div>\r\n  </div>\r\n  ` : ''}\r\n\r\n  <div class=\"prepared-by\">\r\n    <div class=\"section-title\">PREPARED BY</div>\r\n    <div class=\"prepared-by-name\">${preparedBy?.firstName || \"N/A\"} ${preparedBy?.lastName || \"\"}</div>\r\n    ${preparedBy?.phoneNumbers?.length ? `\r\n    <div class=\"prepared-by-title\">Phone: ${preparedBy.phoneNumbers.join(\", \")}</div>\r\n    ` : ''}\r\n  </div>\r\n\r\n  <div class=\"footer-container\">\r\n    <div class=\"tagline\">We work U Relax</div>\r\n    <div class=\"footer\">\r\n      <p><strong>AL GHAZAL AL ABYAD TECHNICAL SERVICES</strong></p>\r\n      <p>Office No:04, R09-France Cluster, International City-Dubai | P.O.Box:262760, Dubai-U.A.E</p>\r\n      <p>Tel: 044102555 | <a href=\"http://www.alghazalgroup.com/\">www.alghazalgroup.com</a></p>\r\n      <p>Generated on ${formatDate(new Date())}</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n`;\r\n\r\n    const browser = await puppeteer.launch({\r\n      headless: \"shell\",\r\n      args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"],\r\n    });\r\n\r\n    try {\r\n      const page = await browser.newPage();\r\n      await page.setContent(htmlContent, {\r\n        waitUntil: [\"load\", \"networkidle0\", \"domcontentloaded\"],\r\n        timeout: 30000,\r\n      });\r\n\r\n      const pdfBuffer = await page.pdf({\r\n        format: \"A4\",\r\n        printBackground: true,\r\n        margin: {\r\n          top: \"1cm\",\r\n          right: \"1cm\",\r\n          bottom: \"1cm\",\r\n          left: \"1cm\",\r\n        },\r\n      });\r\n\r\n      res.setHeader(\"Content-Type\", \"application/pdf\");\r\n      res.setHeader(\r\n        \"Content-Disposition\",\r\n        `attachment; filename=quotation-${quotation.quotationNumber}.pdf`\r\n      );\r\n      res.send(pdfBuffer);\r\n    } catch (error) {\r\n      console.error(\"PDF generation error:\", error);\r\n      throw new ApiError(500, \"Failed to generate PDF\");\r\n    } finally {\r\n      await browser.close();\r\n    }\r\n  }\r\n);"]}