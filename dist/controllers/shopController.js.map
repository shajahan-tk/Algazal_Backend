{"version":3,"file":"shopController.js","sourceRoot":"","sources":["../../src/controllers/shopController.ts"],"names":[],"mappings":";;;AACA,wDAAqD;AACrD,kEAAyD;AACzD,kEAAsD;AACtD,mDAA2C;AAE3C,oDAI6B;AAEhB,QAAA,UAAU,GAAG,IAAA,2BAAY,EAAC,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IAC3E,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,UAAU,EAAE,OAAO,EAAE,GACtE,GAAG,CAAC,IAAI,CAAC;IAEX,wEAAwE;IACxE,IAAI,CAAC,QAAQ,IAAI,CAAC,OAAO,EAAE,CAAC;QAC1B,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,mCAAmC,CAAC,CAAC;IAC/D,CAAC;IAED,wDAAwD;IACxD,IAAI,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC;QACtB,MAAM,YAAY,GAAG,MAAM,gBAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QAC7D,IAAI,YAAY,EAAE,CAAC;YACjB,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,0CAA0C,CAAC,CAAC;QACtE,CAAC;IACH,CAAC;IAED,yDAAyD;IACzD,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,EAAE,CAAC;QAC5B,MAAM,cAAc,GAAG,MAAM,gBAAI,CAAC,OAAO,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;QACrE,IAAI,cAAc,EAAE,CAAC;YACnB,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,sCAAsC,CAAC,CAAC;QAClE,CAAC;IACH,CAAC;IAED,sBAAsB;IACtB,IAAI,eAAe,GAIb,EAAE,CAAC;IAET,+BAA+B;IAC/B,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;QACpC,CAAC,CAAC,GAAG,CAAC,KAAK;QACX,CAAC,CAAC,GAAG,CAAC,KAAK;YACX,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE;YACjC,CAAC,CAAC,EAAE,CAAC;IAEP,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACrB,MAAM,aAAa,GAAG,MAAM,IAAA,sCAAyB,EAAC,KAAK,CAAC,CAAC;QAC7D,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;YAC3B,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,mCAAmC,CAAC,CAAC;QAC/D,CAAC;QACD,eAAe;YACb,aAAa,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;gBACvC,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,IAAI,YAAY;gBACnD,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC,IAAI,EAAE,CAAC;IACd,CAAC;IAED,MAAM,IAAI,GAAG,MAAM,gBAAI,CAAC,MAAM,CAAC;QAC7B,QAAQ;QACR,MAAM,EAAE,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS;QAC3D,OAAO;QACP,GAAG,EAAE,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS;QAC/C,SAAS,EAAE,SAAS,IAAI,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS;QACvE,UAAU;QACV,OAAO,EAAE,OAAO,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS;QAC/D,eAAe;QACf,SAAS,EAAE,GAAG,CAAC,IAAI,EAAE,MAAM;KAC5B,CAAC,CAAC;IAEH,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,+BAAW,CAAC,GAAG,EAAE,IAAI,EAAE,2BAA2B,CAAC,CAAC,CAAC;AAChF,CAAC,CAAC,CAAC;AAEU,QAAA,QAAQ,GAAG,IAAA,2BAAY,EAAC,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IACzE,MAAM,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,IAAc,CAAC,IAAI,CAAC,CAAC;IACrD,MAAM,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,KAAe,CAAC,IAAI,EAAE,CAAC;IACxD,MAAM,IAAI,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC;IAEhC,MAAM,MAAM,GAAQ,EAAE,CAAC;IAEvB,uBAAuB;IACvB,IAAI,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;QACrB,MAAM,gBAAgB,GAAU;YAC9B,EAAE,QAAQ,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE;YACzD,EAAE,OAAO,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE;YACxD,EAAE,MAAM,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE;YACvD,EAAE,OAAO,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE;YACxD,EAAE,GAAG,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE;YACpD,EAAE,SAAS,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE;SAC3D,CAAC;QAEF,MAAM,CAAC,GAAG,GAAG,gBAAgB,CAAC;IAChC,CAAC;IAED,MAAM,KAAK,GAAG,MAAM,gBAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;IAChD,MAAM,KAAK,GAAG,MAAM,gBAAI,CAAC,IAAI,CAAC,MAAM,CAAC;SAClC,IAAI,CAAC,IAAI,CAAC;SACV,KAAK,CAAC,KAAK,CAAC;SACZ,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC;SACvB,QAAQ,CAAC,WAAW,EAAE,0BAA0B,CAAC,CAAC;IAErD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAClB,IAAI,+BAAW,CACb,GAAG,EACH;QACE,KAAK;QACL,UAAU,EAAE;YACV,KAAK;YACL,IAAI;YACJ,KAAK;YACL,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACpC,WAAW,EAAE,IAAI,GAAG,KAAK,GAAG,KAAK;YACjC,eAAe,EAAE,IAAI,GAAG,CAAC;SAC1B;KACF,EACD,8BAA8B,CAC/B,CACF,CAAC;AACJ,CAAC,CAAC,CAAC;AAEU,QAAA,OAAO,GAAG,IAAA,2BAAY,EAAC,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IACxE,MAAM,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;IAE1B,MAAM,IAAI,GAAG,MAAM,gBAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAC3C,WAAW,EACX,0BAA0B,CAC3B,CAAC;IACF,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;IAC5C,CAAC;IAED,GAAG;SACA,MAAM,CAAC,GAAG,CAAC;SACX,IAAI,CAAC,IAAI,+BAAW,CAAC,GAAG,EAAE,IAAI,EAAE,6BAA6B,CAAC,CAAC,CAAC;AACrE,CAAC,CAAC,CAAC;AAEU,QAAA,UAAU,GAAG,IAAA,2BAAY,EAAC,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IAC3E,MAAM,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;IAC1B,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,UAAU,EAAE,OAAO,EAAE,GACtE,GAAG,CAAC,IAAI,CAAC;IAEX,MAAM,IAAI,GAAG,MAAM,gBAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACrC,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;IAC5C,CAAC;IAED,kFAAkF;IAClF,IAAI,GAAG,KAAK,SAAS,EAAE,CAAC;QACtB,IAAI,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,IAAI,GAAG,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC,GAAG,EAAE,CAAC;YACjD,MAAM,YAAY,GAAG,MAAM,gBAAI,CAAC,OAAO,CAAC;gBACtC,GAAG,EAAE,GAAG,CAAC,IAAI,EAAE;gBACf,GAAG,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE;aACjB,CAAC,CAAC;YAEH,IAAI,YAAY,EAAE,CAAC;gBACjB,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,2CAA2C,CAAC,CAAC;YACvE,CAAC;QACH,CAAC;IACH,CAAC;IAED,0FAA0F;IAC1F,IAAI,MAAM,KAAK,SAAS,IAAI,MAAM,KAAK,IAAI,CAAC,MAAM,EAAE,CAAC;QACnD,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,EAAE,CAAC;YAC5B,MAAM,cAAc,GAAG,MAAM,gBAAI,CAAC,OAAO,CAAC;gBACxC,MAAM,EAAE,MAAM,CAAC,IAAI,EAAE;gBACrB,GAAG,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE;aACjB,CAAC,CAAC;YAEH,IAAI,cAAc,EAAE,CAAC;gBACnB,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,4CAA4C,CAAC,CAAC;YACxE,CAAC;QACH,CAAC;IACH,CAAC;IAED,0CAA0C;IAC1C,IAAI,cAAc,GAIZ,EAAE,CAAC;IAET,+BAA+B;IAC/B,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC;QACpC,CAAC,CAAC,GAAG,CAAC,KAAK;QACX,CAAC,CAAC,GAAG,CAAC,KAAK;YACX,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,IAAI,EAAE;YACjC,CAAC,CAAC,EAAE,CAAC;IAEP,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QACrB,MAAM,aAAa,GAAG,MAAM,IAAA,sCAAyB,EAAC,KAAK,CAAC,CAAC;QAC7D,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;YAC3B,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,uCAAuC,CAAC,CAAC;QACnE,CAAC;QACD,cAAc;YACZ,aAAa,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;gBACvC,QAAQ,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,IAAI,YAAY;gBACnD,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,QAAQ,EAAE,IAAI,CAAC,GAAG;aACnB,CAAC,CAAC,IAAI,EAAE,CAAC;IACd,CAAC;IAED,wBAAwB;IACxB,MAAM,UAAU,GAAQ,EAAE,CAAC;IAE3B,IAAI,QAAQ,KAAK,SAAS;QAAE,UAAU,CAAC,QAAQ,GAAG,QAAQ,CAAC;IAC3D,IAAI,MAAM,KAAK,SAAS,EAAE,CAAC;QACzB,UAAU,CAAC,MAAM,GAAG,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IAC1E,CAAC;IACD,IAAI,OAAO,KAAK,SAAS;QAAE,UAAU,CAAC,OAAO,GAAG,OAAO,CAAC;IACxD,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;QAC1B,UAAU,CAAC,OAAO,GAAG,OAAO,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IAC9E,CAAC;IAED,yBAAyB;IACzB,IAAI,GAAG,KAAK,SAAS,EAAE,CAAC;QACtB,UAAU,CAAC,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IAC9D,CAAC;IACD,IAAI,SAAS,KAAK,SAAS,EAAE,CAAC;QAC5B,UAAU,CAAC,SAAS,GAAG,SAAS,IAAI,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IACtF,CAAC;IACD,IAAI,UAAU,KAAK,SAAS,EAAE,CAAC;QAC7B,UAAU,CAAC,UAAU,GAAG,UAAU,IAAI,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;IAC1F,CAAC;IAED,MAAM,WAAW,GAAG,MAAM,gBAAI,CAAC,iBAAiB,CAC9C,EAAE,EACF;QACE,GAAG,UAAU;QACb,KAAK,EAAE,EAAE,eAAe,EAAE,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE;KACtD,EACD,EAAE,GAAG,EAAE,IAAI,EAAE,CACd,CAAC;IAEF,IAAI,CAAC,WAAW,EAAE,CAAC;QACjB,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,uBAAuB,CAAC,CAAC;IACnD,CAAC;IAED,GAAG;SACA,MAAM,CAAC,GAAG,CAAC;SACX,IAAI,CAAC,IAAI,+BAAW,CAAC,GAAG,EAAE,WAAW,EAAE,2BAA2B,CAAC,CAAC,CAAC;AAC1E,CAAC,CAAC,CAAC;AAEU,QAAA,UAAU,GAAG,IAAA,2BAAY,EAAC,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IAC3E,MAAM,EAAE,EAAE,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;IAE1B,MAAM,IAAI,GAAG,MAAM,gBAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACrC,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;IAC5C,CAAC;IAED,sCAAsC;IACtC,IAAI,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QAC5D,MAAM,OAAO,CAAC,GAAG,CACf,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,KAAK,EAAE,UAAU,EAAE,EAAE;YAC5C,IAAI,CAAC;gBACH,MAAM,GAAG,GAAG,IAAA,4BAAe,EAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;gBACjD,MAAM,IAAA,6BAAgB,EAAC,GAAG,CAAC,CAAC;YAC9B,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,OAAO,CAAC,KAAK,CACX,kCAAkC,UAAU,CAAC,QAAQ,EAAE,EACvD,KAAK,CACN,CAAC;YACJ,CAAC;QACH,CAAC,CAAC,CACH,CAAC;IACJ,CAAC;IAED,MAAM,gBAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;IAEjC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,+BAAW,CAAC,GAAG,EAAE,IAAI,EAAE,2BAA2B,CAAC,CAAC,CAAC;AAChF,CAAC,CAAC,CAAC;AAEU,QAAA,YAAY,GAAG,IAAA,2BAAY,EACtC,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IACpC,MAAM,EAAE,SAAS,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;IAEjC,MAAM,IAAI,GAAG,MAAM,gBAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,SAAS,EAAE,CAAC,CAAC,QAAQ,CAC1D,WAAW,EACX,0BAA0B,CAC3B,CAAC;IACF,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;IAC5C,CAAC;IAED,GAAG;SACA,MAAM,CAAC,GAAG,CAAC;SACX,IAAI,CAAC,IAAI,+BAAW,CAAC,GAAG,EAAE,IAAI,EAAE,6BAA6B,CAAC,CAAC,CAAC;AACrE,CAAC,CACF,CAAC;AAEW,QAAA,iBAAiB,GAAG,IAAA,2BAAY,EAC3C,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,EAAE;IACpC,MAAM,EAAE,OAAO,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;IAC/B,MAAM,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,IAAc,CAAC,IAAI,CAAC,CAAC;IACrD,MAAM,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,KAAe,CAAC,IAAI,EAAE,CAAC;IACxD,MAAM,IAAI,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC;IAEhC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC;QAChC,MAAM,IAAI,4BAAQ,CAAC,GAAG,EAAE,wBAAwB,CAAC,CAAC;IACpD,CAAC;IAED,MAAM,KAAK,GAAG,MAAM,gBAAI,CAAC,cAAc,CAAC;QACtC,OAAO,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE;KAC5C,CAAC,CAAC;IAEH,MAAM,KAAK,GAAG,MAAM,gBAAI,CAAC,IAAI,CAAC;QAC5B,OAAO,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE;KAC5C,CAAC;SACC,IAAI,CAAC,IAAI,CAAC;SACV,KAAK,CAAC,KAAK,CAAC;SACZ,IAAI,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC;SACrB,QAAQ,CAAC,WAAW,EAAE,0BAA0B,CAAC,CAAC;IAErD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAClB,IAAI,+BAAW,CACb,GAAG,EACH;QACE,KAAK;QACL,UAAU,EAAE;YACV,KAAK;YACL,IAAI;YACJ,KAAK;YACL,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACpC,WAAW,EAAE,IAAI,GAAG,KAAK,GAAG,KAAK;YACjC,eAAe,EAAE,IAAI,GAAG,CAAC;SAC1B;KACF,EACD,8BAA8B,CAC/B,CACF,CAAC;AACJ,CAAC,CACF,CAAC;AAEF,sCAAsC;AACtC,MAAM,qBAAqB,GAAG,KAAK,EAAE,WAAkB,EAAE,EAAE;IACzD,IAAI,CAAC,WAAW,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO;IAErD,MAAM,OAAO,CAAC,GAAG,CACf,WAAW,CAAC,GAAG,CAAC,KAAK,EAAE,UAAU,EAAE,EAAE;QACnC,IAAI,CAAC;YACH,MAAM,GAAG,GAAG,IAAA,4BAAe,EAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YACjD,MAAM,IAAA,6BAAgB,EAAC,GAAG,CAAC,CAAC;QAC9B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CACX,kCAAkC,UAAU,CAAC,QAAQ,EAAE,EACvD,KAAK,CACN,CAAC;QACJ,CAAC;IACH,CAAC,CAAC,CACH,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import { Request, Response } from \"express\";\r\nimport { asyncHandler } from \"../utils/asyncHandler\";\r\nimport { ApiResponse } from \"../utils/apiHandlerHelpers\";\r\nimport { ApiError } from \"../utils/apiHandlerHelpers\";\r\nimport { Shop } from \"../models/shopModel\";\r\nimport { Types } from \"mongoose\";\r\nimport {\r\n  handleMultipleFileUploads,\r\n  deleteFileFromS3,\r\n  getS3KeyFromUrl,\r\n} from \"../utils/uploadConf\";\r\n\r\nexport const createShop = asyncHandler(async (req: Request, res: Response) => {\r\n  const { shopName, shopNo, address, vat, ownerName, ownerEmail, contact } =\r\n    req.body;\r\n\r\n  // Validate required fields - only shopName and address are required now\r\n  if (!shopName || !address) {\r\n    throw new ApiError(400, \"shopName and address are required\");\r\n  }\r\n\r\n  // Check if VAT number already exists (only if provided)\r\n  if (vat && vat.trim()) {\r\n    const existingShop = await Shop.findOne({ vat: vat.trim() });\r\n    if (existingShop) {\r\n      throw new ApiError(400, \"Shop with this VAT number already exists\");\r\n    }\r\n  }\r\n\r\n  // Check if shop number already exists (only if provided)\r\n  if (shopNo && shopNo.trim()) {\r\n    const existingShopNo = await Shop.findOne({ shopNo: shopNo.trim() });\r\n    if (existingShopNo) {\r\n      throw new ApiError(400, \"Shop with this number already exists\");\r\n    }\r\n  }\r\n\r\n  // Handle file uploads\r\n  let shopAttachments: {\r\n    fileName: string;\r\n    fileType: string;\r\n    filePath: string;\r\n  }[] = [];\r\n\r\n  // Fix for req.files type issue\r\n  const files = Array.isArray(req.files)\r\n    ? req.files\r\n    : req.files\r\n    ? Object.values(req.files).flat()\r\n    : [];\r\n\r\n  if (files.length > 0) {\r\n    const uploadResults = await handleMultipleFileUploads(files);\r\n    if (!uploadResults.success) {\r\n      throw new ApiError(500, \"Failed to upload shop attachments\");\r\n    }\r\n    shopAttachments =\r\n      uploadResults.uploadData?.map((file) => ({\r\n        fileName: file.key.split(\"/\").pop() || \"attachment\",\r\n        fileType: file.mimetype,\r\n        filePath: file.url,\r\n      })) || [];\r\n  }\r\n\r\n  const shop = await Shop.create({\r\n    shopName,\r\n    shopNo: shopNo && shopNo.trim() ? shopNo.trim() : undefined,\r\n    address,\r\n    vat: vat && vat.trim() ? vat.trim() : undefined,\r\n    ownerName: ownerName && ownerName.trim() ? ownerName.trim() : undefined,\r\n    ownerEmail,\r\n    contact: contact && contact.trim() ? contact.trim() : undefined,\r\n    shopAttachments,\r\n    createdBy: req.user?.userId,\r\n  });\r\n\r\n  res.status(201).json(new ApiResponse(201, shop, \"Shop created successfully\"));\r\n});\r\n\r\nexport const getShops = asyncHandler(async (req: Request, res: Response) => {\r\n  const page = parseInt(req.query.page as string) || 1;\r\n  const limit = parseInt(req.query.limit as string) || 10;\r\n  const skip = (page - 1) * limit;\r\n\r\n  const filter: any = {};\r\n\r\n  // Search functionality\r\n  if (req.query.search) {\r\n    const searchConditions: any[] = [\r\n      { shopName: { $regex: req.query.search, $options: \"i\" } },\r\n      { contact: { $regex: req.query.search, $options: \"i\" } },\r\n      { shopNo: { $regex: req.query.search, $options: \"i\" } },\r\n      { address: { $regex: req.query.search, $options: \"i\" } },\r\n      { vat: { $regex: req.query.search, $options: \"i\" } },\r\n      { ownerName: { $regex: req.query.search, $options: \"i\" } }\r\n    ];\r\n    \r\n    filter.$or = searchConditions;\r\n  }\r\n\r\n  const total = await Shop.countDocuments(filter);\r\n  const shops = await Shop.find(filter)\r\n    .skip(skip)\r\n    .limit(limit)\r\n    .sort({ createdAt: -1 })\r\n    .populate(\"createdBy\", \"firstName lastName email\");\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(\r\n      200,\r\n      {\r\n        shops,\r\n        pagination: {\r\n          total,\r\n          page,\r\n          limit,\r\n          totalPages: Math.ceil(total / limit),\r\n          hasNextPage: page * limit < total,\r\n          hasPreviousPage: page > 1,\r\n        },\r\n      },\r\n      \"Shops retrieved successfully\"\r\n    )\r\n  );\r\n});\r\n\r\nexport const getShop = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const shop = await Shop.findById(id).populate(\r\n    \"createdBy\",\r\n    \"firstName lastName email\"\r\n  );\r\n  if (!shop) {\r\n    throw new ApiError(404, \"Shop not found\");\r\n  }\r\n\r\n  res\r\n    .status(200)\r\n    .json(new ApiResponse(200, shop, \"Shop retrieved successfully\"));\r\n});\r\n\r\nexport const updateShop = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n  const { shopName, shopNo, address, vat, ownerName, ownerEmail, contact } =\r\n    req.body;\r\n\r\n  const shop = await Shop.findById(id);\r\n  if (!shop) {\r\n    throw new ApiError(404, \"Shop not found\");\r\n  }\r\n\r\n  // Check if VAT is being updated and conflicts with other shops (only if provided)\r\n  if (vat !== undefined) {\r\n    if (vat && vat.trim() && vat.trim() !== shop.vat) {\r\n      const existingShop = await Shop.findOne({\r\n        vat: vat.trim(),\r\n        _id: { $ne: id },\r\n      });\r\n\r\n      if (existingShop) {\r\n        throw new ApiError(400, \"Another shop already uses this VAT number\");\r\n      }\r\n    }\r\n  }\r\n\r\n  // Check if shop number is being updated and conflicts with other shops (only if provided)\r\n  if (shopNo !== undefined && shopNo !== shop.shopNo) {\r\n    if (shopNo && shopNo.trim()) {\r\n      const existingShopNo = await Shop.findOne({\r\n        shopNo: shopNo.trim(),\r\n        _id: { $ne: id },\r\n      });\r\n\r\n      if (existingShopNo) {\r\n        throw new ApiError(400, \"Another shop already uses this shop number\");\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle file uploads for new attachments\r\n  let newAttachments: {\r\n    fileName: string;\r\n    fileType: string;\r\n    filePath: string;\r\n  }[] = [];\r\n\r\n  // Fix for req.files type issue\r\n  const files = Array.isArray(req.files)\r\n    ? req.files\r\n    : req.files\r\n    ? Object.values(req.files).flat()\r\n    : [];\r\n\r\n  if (files.length > 0) {\r\n    const uploadResults = await handleMultipleFileUploads(files);\r\n    if (!uploadResults.success) {\r\n      throw new ApiError(500, \"Failed to upload new shop attachments\");\r\n    }\r\n    newAttachments =\r\n      uploadResults.uploadData?.map((file) => ({\r\n        fileName: file.key.split(\"/\").pop() || \"attachment\",\r\n        fileType: file.mimetype,\r\n        filePath: file.url,\r\n      })) || [];\r\n  }\r\n\r\n  // Prepare update object\r\n  const updateData: any = {};\r\n  \r\n  if (shopName !== undefined) updateData.shopName = shopName;\r\n  if (shopNo !== undefined) {\r\n    updateData.shopNo = shopNo && shopNo.trim() ? shopNo.trim() : undefined;\r\n  }\r\n  if (address !== undefined) updateData.address = address;\r\n  if (contact !== undefined) {\r\n    updateData.contact = contact && contact.trim() ? contact.trim() : undefined;\r\n  }\r\n  \r\n  // Handle optional fields\r\n  if (vat !== undefined) {\r\n    updateData.vat = vat && vat.trim() ? vat.trim() : undefined;\r\n  }\r\n  if (ownerName !== undefined) {\r\n    updateData.ownerName = ownerName && ownerName.trim() ? ownerName.trim() : undefined;\r\n  }\r\n  if (ownerEmail !== undefined) {\r\n    updateData.ownerEmail = ownerEmail && ownerEmail.trim() ? ownerEmail.trim() : undefined;\r\n  }\r\n\r\n  const updatedShop = await Shop.findByIdAndUpdate(\r\n    id,\r\n    {\r\n      ...updateData,\r\n      $push: { shopAttachments: { $each: newAttachments } },\r\n    },\r\n    { new: true }\r\n  );\r\n\r\n  if (!updatedShop) {\r\n    throw new ApiError(500, \"Failed to update shop\");\r\n  }\r\n\r\n  res\r\n    .status(200)\r\n    .json(new ApiResponse(200, updatedShop, \"Shop updated successfully\"));\r\n});\r\n\r\nexport const deleteShop = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const shop = await Shop.findById(id);\r\n  if (!shop) {\r\n    throw new ApiError(404, \"Shop not found\");\r\n  }\r\n\r\n  // Delete all associated files from S3\r\n  if (shop.shopAttachments && shop.shopAttachments.length > 0) {\r\n    await Promise.all(\r\n      shop.shopAttachments.map(async (attachment) => {\r\n        try {\r\n          const key = getS3KeyFromUrl(attachment.filePath);\r\n          await deleteFileFromS3(key);\r\n        } catch (error) {\r\n          console.error(\r\n            `Failed to delete file from S3: ${attachment.filePath}`,\r\n            error\r\n          );\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  await Shop.findByIdAndDelete(id);\r\n\r\n  res.status(200).json(new ApiResponse(200, null, \"Shop deleted successfully\"));\r\n});\r\n\r\nexport const getShopByVat = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    const { vatNumber } = req.params;\r\n\r\n    const shop = await Shop.findOne({ vat: vatNumber }).populate(\r\n      \"createdBy\",\r\n      \"firstName lastName email\"\r\n    );\r\n    if (!shop) {\r\n      throw new ApiError(404, \"Shop not found\");\r\n    }\r\n\r\n    res\r\n      .status(200)\r\n      .json(new ApiResponse(200, shop, \"Shop retrieved successfully\"));\r\n  }\r\n);\r\n\r\nexport const getShopsByPincode = asyncHandler(\r\n  async (req: Request, res: Response) => {\r\n    const { pincode } = req.params;\r\n    const page = parseInt(req.query.page as string) || 1;\r\n    const limit = parseInt(req.query.limit as string) || 10;\r\n    const skip = (page - 1) * limit;\r\n\r\n    if (!/^[0-9]{6}$/.test(pincode)) {\r\n      throw new ApiError(400, \"Invalid pincode format\");\r\n    }\r\n\r\n    const total = await Shop.countDocuments({\r\n      address: { $regex: pincode, $options: \"i\" },\r\n    });\r\n\r\n    const shops = await Shop.find({\r\n      address: { $regex: pincode, $options: \"i\" },\r\n    })\r\n      .skip(skip)\r\n      .limit(limit)\r\n      .sort({ shopName: 1 })\r\n      .populate(\"createdBy\", \"firstName lastName email\");\r\n\r\n    res.status(200).json(\r\n      new ApiResponse(\r\n        200,\r\n        {\r\n          shops,\r\n          pagination: {\r\n            total,\r\n            page,\r\n            limit,\r\n            totalPages: Math.ceil(total / limit),\r\n            hasNextPage: page * limit < total,\r\n            hasPreviousPage: page > 1,\r\n          },\r\n        },\r\n        \"Shops retrieved successfully\"\r\n      )\r\n    );\r\n  }\r\n);\r\n\r\n// Additional helper methods if needed\r\nconst deleteShopAttachments = async (attachments: any[]) => {\r\n  if (!attachments || attachments.length === 0) return;\r\n\r\n  await Promise.all(\r\n    attachments.map(async (attachment) => {\r\n      try {\r\n        const key = getS3KeyFromUrl(attachment.filePath);\r\n        await deleteFileFromS3(key);\r\n      } catch (error) {\r\n        console.error(\r\n          `Failed to delete file from S3: ${attachment.filePath}`,\r\n          error\r\n        );\r\n      }\r\n    })\r\n  );\r\n};"]}