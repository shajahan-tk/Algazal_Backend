{"version":3,"file":"payrollController.js","sourceRoot":"","sources":["../../src/controllers/payrollController.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response } from \"express\";\r\nimport { asyncHandler } from \"../utils/asyncHandler\";\r\nimport { ApiResponse } from \"../utils/apiHandlerHelpers\";\r\nimport { ApiError } from \"../utils/apiHandlerHelpers\";\r\nimport { Payroll } from \"../models/payrollModel\";\r\nimport { IUser, User } from \"../models/userModel\";\r\nimport { EmployeeExpense } from \"../models/employeeExpenseModel\";\r\nimport { Attendance } from \"../models/attendanceModel\";\r\nimport ExcelJS from \"exceljs\";\r\nimport { Types } from \"mongoose\";\r\nimport puppeteer from \"puppeteer\";\r\nimport { VisaExpense } from \"../models/visaExpenseModel\";\r\n\r\n// Helper function to calculate overtime for previous month\r\nexport const calculatePreviousMonthOvertimeAmount = async (\r\n  userId: Types.ObjectId,\r\n  basicSalary: number\r\n) => {\r\n  try {\r\n    const now = new Date();\r\n    const previousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n    const year = previousMonth.getFullYear();\r\n    const month = previousMonth.getMonth() + 1; // JavaScript months are 0-indexed\r\n\r\n    const startDate = new Date(year, month - 1, 1);\r\n    startDate.setHours(0, 0, 0, 0);\r\n\r\n    const endDate = new Date(year, month, 0);\r\n    endDate.setHours(23, 59, 59, 999);\r\n\r\n    const daysInMonth = endDate.getDate();\r\n\r\n    console.log(`Calculating overtime for user ${userId} for previous month: ${month}-${year}`);\r\n    console.log(`Days in month: ${daysInMonth}, Basic Salary: ${basicSalary}`);\r\n\r\n    const attendances = await Attendance.find({\r\n      user: userId,\r\n      date: { $gte: startDate, $lte: endDate },\r\n      present: true\r\n    });\r\n\r\n    console.log(`Found ${attendances.length} attendance records for previous month`);\r\n\r\n    const totalOvertimeHours = attendances.reduce((total, attendance) => {\r\n      const ot = attendance.overtimeHours || 0;\r\n      console.log(`Date: ${attendance.date}, OT Hours: ${ot}`);\r\n      return total + ot;\r\n    }, 0);\r\n\r\n    const hourlyRate = (basicSalary / daysInMonth) / 10;\r\n    const overtimeAmount = totalOvertimeHours * hourlyRate;\r\n\r\n    console.log(`Total OT hours: ${totalOvertimeHours}, Hourly rate: ${hourlyRate.toFixed(2)}, OT amount: ${overtimeAmount.toFixed(2)}`);\r\n\r\n    return {\r\n      overtimeHours: totalOvertimeHours,\r\n      overtimeAmount: Math.round(overtimeAmount * 100) / 100,\r\n      hourlyRate: Math.round(hourlyRate * 100) / 100,\r\n      daysInMonth\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error calculating previous month overtime:\", error);\r\n    return {\r\n      overtimeHours: 0,\r\n      overtimeAmount: 0,\r\n      hourlyRate: 0,\r\n      daysInMonth: 30\r\n    };\r\n  }\r\n};\r\n\r\n// Helper function to get month number from month name\r\nconst getMonthNumber = (monthName: string): number => {\r\n  const months: { [key: string]: number } = {\r\n    'January': 1,\r\n    'February': 2,\r\n    'March': 3,\r\n    'April': 4,\r\n    'May': 5,\r\n    'June': 6,\r\n    'July': 7,\r\n    'August': 8,\r\n    'September': 9,\r\n    'October': 10,\r\n    'November': 11,\r\n    'December': 12\r\n  };\r\n  return months[monthName] || 0;\r\n};\r\n\r\n// Helper function to format date\r\nconst formatDate = (date: Date | string | undefined): string => {\r\n  if (!date) return 'N/A';\r\n  const d = new Date(date);\r\n  return isNaN(d.getTime()) ? 'N/A' : d.toLocaleDateString('en-GB', { \r\n    day: '2-digit', \r\n    month: '2-digit', \r\n    year: 'numeric' \r\n  });\r\n};\r\n\r\n// Get attendance details for a specific period with Sunday tracking\r\nconst getAttendanceDetails = async (userId: Types.ObjectId, period: string) => {\r\n  try {\r\n    // Validate inputs\r\n    if (!userId || !period) {\r\n      return {\r\n        summary: {\r\n          totalDays: 0,\r\n          presentDays: 0,\r\n          absentDays: 0,\r\n          holidays: 0,\r\n          fridays: 0,\r\n          saturdays: 0,\r\n          sundays: 0\r\n        }\r\n      };\r\n    }\r\n\r\n    const filter: any = {\r\n      user: userId\r\n    };\r\n\r\n    // Add date filter if period is provided\r\n    if (period) {\r\n      // Parse period (expected format: MM-YYYY)\r\n      const [monthStr, yearStr] = period.split('-');\r\n      \r\n      if (!monthStr || !yearStr) {\r\n        console.log('Invalid period format:', period);\r\n        return {\r\n          summary: {\r\n            totalDays: 0,\r\n            presentDays: 0,\r\n            absentDays: 0,\r\n            holidays: 0,\r\n            fridays: 0,\r\n            saturdays: 0,\r\n            sundays: 0\r\n          }\r\n        };\r\n      }\r\n\r\n      const monthNum = parseInt(monthStr, 10);\r\n      const yearNum = parseInt(yearStr, 10);\r\n\r\n      if (isNaN(monthNum) || isNaN(yearNum) || monthNum < 1 || monthNum > 12) {\r\n        console.log('Invalid month/year in period:', period);\r\n        return {\r\n          summary: {\r\n            totalDays: 0,\r\n            presentDays: 0,\r\n            absentDays: 0,\r\n            holidays: 0,\r\n            fridays: 0,\r\n            saturdays: 0,\r\n            sundays: 0\r\n          }\r\n        };\r\n      }\r\n\r\n      // Create VALID date range for the specific month\r\n      // JavaScript months are 0-indexed (0=Jan, 1=Feb, etc.)\r\n      const startDate = new Date(yearNum, monthNum - 1, 1);\r\n      const endDate = new Date(yearNum, monthNum, 0); // 0th day of next month is last day of current month\r\n      \r\n      console.log('Date range for attendance:', {\r\n        period,\r\n        startDate: startDate.toISOString(),\r\n        endDate: endDate.toISOString()\r\n      });\r\n\r\n      filter.date = {\r\n        $gte: startDate,\r\n        $lte: endDate\r\n      };\r\n    }\r\n\r\n    console.log('Attendance filter:', filter);\r\n\r\n    const attendances = await Attendance.find(filter)\r\n      .populate('user', 'firstName lastName')\r\n      .sort({ date: 1 });\r\n\r\n    // Initialize counters\r\n    let totalDays = 0;\r\n    let presentDays = 0;\r\n    let absentDays = 0;\r\n    let dutyOffDays = 0;\r\n    let totalHours = 0;\r\n    let overtimeHours = 0;\r\n    let sundayWorkingDays = 0;\r\n    let sundayOvertimeHours = 0;\r\n\r\n    const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];\r\n\r\n    // Process attendance records\r\n    const attendanceRecords = attendances.map((att, index) => {\r\n      if (!att.date) return;\r\n\r\n      totalDays++;\r\n      \r\n      const date = new Date(att.date);\r\n      const dayName = days[date.getDay()];\r\n      const isSunday = date.getDay() === 0;\r\n\r\n      let status = 'ABSENT';\r\n      let hours = 0;\r\n\r\n      if (att.isPaidLeave) {\r\n        status = 'DUTY OFF';\r\n        dutyOffDays++;\r\n      } else if (att.present) {\r\n        status = 'PRESENT';\r\n        hours = att.workingHours || 0;\r\n        totalHours += hours;\r\n        overtimeHours += att.overtimeHours || 0;\r\n        presentDays++;\r\n\r\n        // Track Sunday working separately\r\n        if (isSunday) {\r\n          sundayWorkingDays++;\r\n          sundayOvertimeHours += att.overtimeHours || 0;\r\n        }\r\n      } else {\r\n        absentDays++;\r\n      }\r\n\r\n      return {\r\n        sno: index + 1,\r\n        date: date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }),\r\n        day: dayName,\r\n        status,\r\n        hours: hours.toFixed(2),\r\n        overtimeHours: (att.overtimeHours || 0).toFixed(2),\r\n        isSunday\r\n      };\r\n    });\r\n\r\n    const summary = {\r\n      totalDays,\r\n      presentDays,\r\n      absentDays,\r\n      dutyOffDays,\r\n      totalHours: totalHours.toFixed(2),\r\n      overtimeHours: overtimeHours.toFixed(2),\r\n      sundayWorkingDays,\r\n      sundayOvertimeHours: sundayOvertimeHours.toFixed(2)\r\n    };\r\n\r\n    console.log('Attendance summary:', summary);\r\n\r\n    return {\r\n      records: attendanceRecords,\r\n      summary\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Error in getAttendanceDetails:', error);\r\n    return {\r\n      summary: {\r\n        totalDays:  0,\r\n        presentDays: 0,\r\n        absentDays: 0,\r\n        holidays: 0,\r\n        fridays: 0,\r\n        saturdays: 0,\r\n        sundays: 0\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\n// New function to get attendance details by month and year\r\nconst getAttendanceDetailsByMonthYear = async (userId: Types.ObjectId, month: number, year: number) => {\r\n  try {\r\n    // Validate inputs\r\n    if (!userId || !month || !year) {\r\n      return {\r\n        summary: {\r\n          totalDays: 0,\r\n          presentDays: 0,\r\n          absentDays: 0,\r\n          holidays: 0,\r\n          fridays: 0,\r\n          saturdays: 0,\r\n          sundays: 0\r\n        }\r\n      };\r\n    }\r\n\r\n    const filter: any = {\r\n      user: userId\r\n    };\r\n\r\n    // Create date range for specific month and year\r\n    // JavaScript months are 0-indexed (0=Jan, 1=Feb, etc.)\r\n    const startDate = new Date(year, month - 1, 1);\r\n    const endDate = new Date(year, month, 0); // Last day of month\r\n    \r\n    // Validate dates\r\n    if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {\r\n      console.log('Invalid dates created:', { startDate, endDate, month, year });\r\n      return {\r\n        summary: {\r\n          totalDays: 0,\r\n          presentDays: 0,\r\n          absentDays: 0,\r\n          holidays: 0,\r\n          fridays: 0,\r\n          saturdays: 0,\r\n          sundays: 0\r\n        }\r\n      };\r\n    }\r\n\r\n    console.log('Date range for attendance:', {\r\n      month,\r\n      year,\r\n      startDate: startDate.toISOString(),\r\n      endDate: endDate.toISOString()\r\n    });\r\n\r\n    filter.date = {\r\n      $gte: startDate,\r\n      $lte: endDate\r\n    };\r\n\r\n    const attendances = await Attendance.find(filter)\r\n      .populate('user', 'firstName lastName')\r\n      .sort({ date: 1 });\r\n\r\n    // Initialize counters\r\n    let totalDays = 0;\r\n    let presentDays = 0;\r\n    let absentDays = 0;\r\n    let dutyOffDays = 0;\r\n    let totalHours = 0;\r\n    let overtimeHours = 0;\r\n    let sundayWorkingDays = 0;\r\n    let sundayOvertimeHours = 0;\r\n\r\n    const days = ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'];\r\n\r\n    // Process attendance records\r\n    const attendanceRecords = attendances.map((att, index) => {\r\n      if (!att.date) return;\r\n\r\n      totalDays++;\r\n      \r\n      const date = new Date(att.date);\r\n      const dayName = days[date.getDay()];\r\n      const isSunday = date.getDay() === 0;\r\n\r\n      let status = 'ABSENT';\r\n      let hours = 0;\r\n\r\n      if (att.isPaidLeave) {\r\n        status = 'DUTY OFF';\r\n        dutyOffDays++;\r\n      } else if (att.present) {\r\n        status = 'PRESENT';\r\n        hours = att.workingHours || 0;\r\n        totalHours += hours;\r\n        overtimeHours += att.overtimeHours || 0;\r\n        presentDays++;\r\n\r\n        // Track Sunday working separately\r\n        if (isSunday) {\r\n          sundayWorkingDays++;\r\n          sundayOvertimeHours += att.overtimeHours || 0;\r\n        }\r\n      } else {\r\n        absentDays++;\r\n      }\r\n\r\n      return {\r\n        sno: index + 1,\r\n        date: date.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }),\r\n        day: dayName,\r\n        status,\r\n        hours: hours.toFixed(2),\r\n        overtimeHours: (att.overtimeHours || 0).toFixed(2),\r\n        isSunday\r\n      };\r\n    });\r\n\r\n    const summary = {\r\n      totalDays,\r\n      presentDays,\r\n      absentDays,\r\n      dutyOffDays,\r\n      totalHours: totalHours.toFixed(2),\r\n      overtimeHours: overtimeHours.toFixed(2),\r\n      sundayWorkingDays,\r\n      sundayOvertimeHours: sundayOvertimeHours.toFixed(2)\r\n    };\r\n\r\n    console.log('Attendance summary:', summary);\r\n\r\n    return {\r\n      records: attendanceRecords,\r\n      summary\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Error in getAttendanceDetailsByMonthYear:', error);\r\n    return {\r\n      summary: {\r\n        totalDays: 0,\r\n        presentDays: 0,\r\n        absentDays: 0,\r\n        holidays: 0,\r\n        fridays: 0,\r\n        saturdays: 0,\r\n        sundays: 0\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\n// Get all payroll records with comprehensive data\r\nexport const getPayrolls = asyncHandler(async (req: Request, res: Response) => {\r\n  const {\r\n    employee,\r\n    labourCard,\r\n    labourCardPersonalNo,\r\n    startDate,\r\n    endDate,\r\n    month,\r\n    year,\r\n    page = 1,\r\n    limit = 10\r\n  } = req.query;\r\n\r\n  const skip = (Number(page) - 1) * Number(limit);\r\n\r\n  interface PayrollFilter {\r\n    employee?: Types.ObjectId | string;\r\n    labourCard?: string;\r\n    labourCardPersonalNo?: string;\r\n    createdAt?: {\r\n      $gte?: Date;\r\n      $lte?: Date;\r\n    };\r\n  }\r\n\r\n  const filter: PayrollFilter = {};\r\n\r\n  if (employee) filter.employee = new Types.ObjectId(employee as string);\r\n  if (labourCard) filter.labourCard = labourCard as string;\r\n  if (labourCardPersonalNo) filter.labourCardPersonalNo = labourCardPersonalNo as string;\r\n\r\n  // Initialize createdAt filter if not already present\r\n  if (!filter.createdAt) filter.createdAt = {};\r\n\r\n  if (startDate && endDate) {\r\n    // Validate and parse the dates\r\n    const start = new Date(startDate as string);\r\n    const end = new Date(endDate as string);\r\n    \r\n    // Check if dates are valid\r\n    if (isNaN(start.getTime()) || isNaN(end.getTime())) {\r\n      throw new ApiError(400, \"Invalid date format in startDate or endDate\");\r\n    }\r\n    \r\n    filter.createdAt = {\r\n      $gte: start,\r\n      $lte: end\r\n    };\r\n  } else if (year) {\r\n    const yearNum = parseInt(year as string);\r\n    if (isNaN(yearNum)) {\r\n      throw new ApiError(400, \"Invalid year value\");\r\n    }\r\n    \r\n    if (month) {\r\n      const monthNum = parseInt(month as string);\r\n      if (isNaN(monthNum) || monthNum < 1 || monthNum > 12) {\r\n        throw new ApiError(400, \"Invalid month value (1-12)\");\r\n      }\r\n      \r\n      // Create date range for the specific month\r\n      // JavaScript months are 0-indexed (0=Jan, 1=Feb, etc.)\r\n      const startDateOfMonth = new Date(yearNum, monthNum - 1, 1);\r\n      const endDateOfMonth = new Date(yearNum, monthNum, 0); // 0th day of next month is last day of current month\r\n      \r\n      console.log('Filtering by month/year:', {\r\n        year: yearNum,\r\n        month: monthNum,\r\n        startDate: startDateOfMonth.toISOString(),\r\n        endDate: endDateOfMonth.toISOString()\r\n      });\r\n      \r\n      filter.createdAt = {\r\n        $gte: startDateOfMonth,\r\n        $lte: endDateOfMonth\r\n      };\r\n    } else {\r\n      // If only year is provided, get entire year\r\n      filter.createdAt = {\r\n        $gte: new Date(yearNum, 0, 1),\r\n        $lte: new Date(yearNum + 1, 0, 1)\r\n      };\r\n    }\r\n  }\r\n\r\n  console.log('Final payroll filter:', filter);\r\n\r\n  const total = await Payroll.countDocuments(filter);\r\n\r\n  const payrolls = await Payroll.find(filter)\r\n    .skip(skip)\r\n    .limit(Number(limit))\r\n    .sort({ createdAt: -1 }) // Sort by creation date\r\n    .populate<{ employee: IUser }>({\r\n      path: 'employee',\r\n      select: 'firstName lastName role emiratesId'\r\n    })\r\n    .populate<{ createdBy: IUser }>({\r\n      path: 'createdBy',\r\n      select: 'firstName lastName'\r\n    });\r\n\r\n  const enhancedPayrolls = await Promise.all(\r\n    payrolls.map(async (payroll) => {\r\n      if (!payroll.employee || typeof payroll.employee !== 'object') {\r\n        throw new Error('Employee data not properly populated');\r\n      }\r\n\r\n      const employeeExpense = await EmployeeExpense.findOne({\r\n        employee: payroll.employee._id\r\n      }).lean();\r\n\r\n      // Get attendance details - DON'T pass period since we're filtering by month/year\r\n      const attendanceDetails = await getAttendanceDetailsByMonthYear(\r\n        payroll.employee._id, \r\n        getMonthNumber(payroll.period.split('-')[0]),\r\n        parseInt(payroll.period.split('-')[1])\r\n      );\r\n\r\n      const totalEarnings = (employeeExpense?.basicSalary || 0) +\r\n        payroll.allowance +\r\n        payroll.transport +\r\n        payroll.overtime +\r\n        payroll.medical +\r\n        payroll.bonus;\r\n\r\n      const totalDeductions = payroll.mess +\r\n        payroll.salaryAdvance +\r\n        payroll.loanDeduction +\r\n        payroll.fineAmount +\r\n        (payroll.visaDeduction || 0);\r\n\r\n      return {\r\n        _id: payroll._id,\r\n        name: `${payroll.employee.firstName} ${payroll.employee.lastName}`,\r\n        designation: payroll.employee.role,\r\n        emiratesId: payroll.employee.emiratesId || 'N/A',\r\n        labourCard: payroll.labourCard,\r\n        labourCardPersonalNo: payroll.labourCardPersonalNo,\r\n        period: payroll.period,\r\n        basicSalary: employeeExpense?.basicSalary || 0,\r\n        allowance: payroll.allowance,\r\n        transport: payroll.transport,\r\n        overtime: payroll.overtime,\r\n        medical: payroll.medical,\r\n        bonus: payroll.bonus,\r\n        totalEarnings,\r\n        mess: payroll.mess,\r\n        salaryAdvance: payroll.salaryAdvance,\r\n        loanDeduction: payroll.loanDeduction,\r\n        fineAmount: payroll.fineAmount,\r\n        visaDeduction: payroll.visaDeduction || 0,\r\n        totalDeductions,\r\n        net: payroll.net,\r\n        remark: payroll.remark,\r\n        // Include attendance summary with Sunday tracking\r\n        attendanceSummary: attendanceDetails.summary,\r\n        createdBy: payroll.createdBy\r\n          ? `${payroll.createdBy.firstName} ${payroll.createdBy.lastName}`\r\n          : 'System',\r\n        createdAt: payroll.createdAt\r\n      };\r\n    })\r\n  );\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(\r\n      200,\r\n      {\r\n        payrolls: enhancedPayrolls,\r\n        pagination: {\r\n          total,\r\n          page: Number(page),\r\n          limit: Number(limit),\r\n          totalPages: Math.ceil(total / Number(limit)),\r\n          hasNextPage: Number(page) * Number(limit) < total,\r\n          hasPreviousPage: Number(page) > 1,\r\n        },\r\n      },\r\n      \"Payrolls retrieved successfully\"\r\n    )\r\n  );\r\n});\r\n\r\n// Create payroll record\r\nexport const createPayroll = asyncHandler(async (req: Request, res: Response) => {\r\n  let {\r\n    employee,\r\n    labourCard,\r\n    labourCardPersonalNo,\r\n    allowance,\r\n    transport,\r\n    medical,\r\n    bonus,\r\n    specialOT,\r\n    mess,\r\n    salaryAdvance,\r\n    loanDeduction,\r\n    fineAmount,\r\n    visaDeduction,\r\n    remark\r\n  } = req.body;\r\n\r\n  console.log('====================================');\r\n  console.log('Creating payroll for previous month:', req.body);\r\n  console.log('====================================');\r\n\r\n  allowance = Number(allowance) || 0;\r\n  transport = Number(transport) || 0;\r\n  medical = Number(medical) || 0;\r\n  bonus = Number(bonus) || 0;\r\n  specialOT = Number(specialOT) || 0;\r\n  mess = Number(mess) || 0;\r\n  salaryAdvance = Number(salaryAdvance) || 0;\r\n  loanDeduction = Number(loanDeduction) || 0;\r\n  fineAmount = Number(fineAmount) || 0;\r\n  visaDeduction = Number(visaDeduction) || 0;\r\n\r\n  if (!employee || !labourCard || !labourCardPersonalNo) {\r\n    throw new ApiError(400, \"Required fields are missing\");\r\n  }\r\n\r\n  const employeeExists = await User.findById(employee);\r\n  if (!employeeExists) {\r\n    throw new ApiError(404, \"Employee not found\");\r\n  }\r\n\r\n  const now = new Date();\r\n  const previousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n  const period = `${String(previousMonth.getMonth() + 1).padStart(2, '0')}-${previousMonth.getFullYear()}`;\r\n\r\n  console.log(`Auto-generated period for payroll: ${period}`);\r\n\r\n  const existingPayroll = await Payroll.findOne({ employee, period });\r\n  if (existingPayroll) {\r\n    throw new ApiError(400, `Payroll already exists for this employee for period ${period}`);\r\n  }\r\n\r\n  const employeeExpense = await EmployeeExpense.findOne({ employee });\r\n  const basicSalary = Number(employeeExpense?.basicSalary) || 0;\r\n\r\n  const overtimeData = await calculatePreviousMonthOvertimeAmount(employee, basicSalary);\r\n  const overtime = overtimeData.overtimeAmount;\r\n\r\n  const totalEarnings = basicSalary + allowance + transport + overtime + specialOT + medical + bonus;\r\n  const totalDeductions = mess + salaryAdvance + loanDeduction + fineAmount + visaDeduction;\r\n\r\n  const net = totalEarnings - totalDeductions;\r\n\r\n  const payroll = await Payroll.create({\r\n    employee,\r\n    labourCard,\r\n    labourCardPersonalNo,\r\n    period,\r\n    allowance,\r\n    transport,\r\n    overtime,\r\n    specialOT,\r\n    medical,\r\n    bonus,\r\n    mess,\r\n    salaryAdvance,\r\n    loanDeduction,\r\n    fineAmount,\r\n    visaDeduction,\r\n    net,\r\n    remark,\r\n    createdBy: req.user?.userId\r\n  });\r\n\r\n  console.log(`Payroll created successfully for period ${period} with overtime: ${overtime}, special OT: ${specialOT}, visa deduction: ${visaDeduction}`);\r\n\r\n  res.status(201).json(\r\n    new ApiResponse(201, payroll, \"Payroll created successfully for previous month\")\r\n  );\r\n});\r\n\r\n// Update payroll record\r\nexport const updatePayroll = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n  const updateData = req.body;\r\n\r\n  const payroll = await Payroll.findById(id);\r\n  if (!payroll) {\r\n    throw new ApiError(404, \"Payroll not found\");\r\n  }\r\n\r\n  // Don'T allow period or overtime to be changed (overtime is auto-calculated)\r\n  delete updateData.period;\r\n  delete updateData.overtime;\r\n\r\n  // Validate if employee is being changed\r\n  if (updateData.employee) {\r\n    const employeeId = updateData.employee;\r\n    const period = payroll.period;\r\n\r\n    const existingPayroll = await Payroll.findOne({\r\n      _id: { $ne: id },\r\n      employee: employeeId,\r\n      period\r\n    });\r\n\r\n    if (existingPayroll) {\r\n      throw new ApiError(400, \"Payroll already exists for this employee and period\");\r\n    }\r\n  }\r\n\r\n  // Convert all numeric fields to numbers\r\n  if (updateData.allowance !== undefined) updateData.allowance = Number(updateData.allowance) || 0;\r\n  if (updateData.transport !== undefined) updateData.transport = Number(updateData.transport) || 0;\r\n  if (updateData.specialOT !== undefined) updateData.specialOT = Number(updateData.specialOT) || 0;\r\n  if (updateData.medical !== undefined) updateData.medical = Number(updateData.medical) || 0;\r\n  if (updateData.bonus !== undefined) updateData.bonus = Number(updateData.bonus) || 0;\r\n  if (updateData.mess !== undefined) updateData.mess = Number(updateData.mess) || 0;\r\n  if (updateData.salaryAdvance !== undefined) updateData.salaryAdvance = Number(updateData.salaryAdvance) || 0;\r\n  if (updateData.loanDeduction !== undefined) updateData.loanDeduction = Number(updateData.loanDeduction) || 0;\r\n  if (updateData.fineAmount !== undefined) updateData.fineAmount = Number(updateData.fineAmount) || 0;\r\n  if (updateData.visaDeduction !== undefined) updateData.visaDeduction = Number(updateData.visaDeduction) || 0;\r\n\r\n  // Fetch employee expense to get basic salary\r\n  const employeeExpense = await EmployeeExpense.findOne({\r\n    employee: updateData.employee || payroll.employee\r\n  });\r\n\r\n  const basicSalary = Number(employeeExpense?.basicSalary) || 0;\r\n  \r\n  // Use updated values if provided, otherwise keep existing\r\n  const allowance = updateData.allowance !== undefined ? updateData.allowance : payroll.allowance;\r\n  const transport = updateData.transport !== undefined ? updateData.transport : payroll.transport;\r\n  const specialOT = updateData.specialOT !== undefined ? updateData.specialOT : (payroll.specialOT || 0);\r\n  const medical = updateData.medical !== undefined ? updateData.medical : payroll.medical;\r\n  const bonus = updateData.bonus !== undefined ? updateData.bonus : payroll.bonus;\r\n  const mess = updateData.mess !== undefined ? updateData.mess : payroll.mess;\r\n  const salaryAdvance = updateData.salaryAdvance !== undefined ? updateData.salaryAdvance : payroll.salaryAdvance;\r\n  const loanDeduction = updateData.loanDeduction !== undefined ? updateData.loanDeduction : payroll.loanDeduction;\r\n  const fineAmount = updateData.fineAmount !== undefined ? updateData.fineAmount : payroll.fineAmount;\r\n  const visaDeduction = updateData.visaDeduction !== undefined ? updateData.visaDeduction : (payroll.visaDeduction || 0);\r\n  \r\n  // Keep existing overtime (it's auto-calculated, shouldn't be changed manually)\r\n  const overtime = payroll.overtime;\r\n\r\n  // Recalculate net salary\r\n  const totalEarnings = basicSalary + allowance + transport + overtime + specialOT + medical + bonus;\r\n  const totalDeductions = mess + salaryAdvance + loanDeduction + fineAmount + visaDeduction;\r\n  updateData.net = totalEarnings - totalDeductions;\r\n\r\n  console.log('Update calculation:', {\r\n    basicSalary,\r\n    allowance,\r\n    transport,\r\n    overtime,\r\n    specialOT,\r\n    medical,\r\n    bonus,\r\n    totalEarnings,\r\n    mess,\r\n    salaryAdvance,\r\n    loanDeduction,\r\n    fineAmount,\r\n    visaDeduction,\r\n    totalDeductions,\r\n    net: updateData.net\r\n  });\r\n\r\n  const updatedPayroll = await Payroll.findByIdAndUpdate(id, updateData, {\r\n    new: true,\r\n    runValidators: true\r\n  })\r\n    .populate({\r\n      path: \"employee\",\r\n      select: \"firstName lastName role emiratesId\"\r\n    })\r\n    .populate({\r\n      path: \"createdBy\",\r\n      select: \"firstName lastName\"\r\n    });\r\n\r\n  if (!updatedPayroll) {\r\n    throw new ApiError(404, \"Payroll not found after update\");\r\n  }\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(200, updatedPayroll, \"Payroll updated successfully\")\r\n  );\r\n});\r\n\r\n// Delete payroll record\r\nexport const deletePayroll = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const payroll = await Payroll.findByIdAndDelete(id);\r\n\r\n  if (!payroll) {\r\n    throw new ApiError(404, \"Payroll not found\");\r\n  }\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(200, null, \"Payroll deleted successfully\")\r\n  );\r\n});\r\n\r\n// Export payrolls to Excel\r\nexport const exportPayrollsToExcel = asyncHandler(async (req: Request, res: Response) => {\r\n  const { month, year, search, employee, period, labourCard, startDate, endDate } = req.query;\r\n\r\n  const filter: Record<string, unknown> = {};\r\n\r\n  if (month && year) {\r\n    const startOfMonth = new Date(Number(year), Number(month) - 1, 1);\r\n    const endOfMonth = new Date(Number(year), Number(month), 0, 23, 59, 59, 999);\r\n    \r\n    console.log('Exporting by month/year:', {\r\n      month,\r\n      year,\r\n      startDate: startOfMonth.toISOString(),\r\n      endDate: endOfMonth.toISOString()\r\n    });\r\n    \r\n    filter.createdAt = {\r\n      $gte: startOfMonth,\r\n      $lte: endOfMonth\r\n    };\r\n  } else if (year) {\r\n    const startOfYear = new Date(Number(year), 0, 1);\r\n    const endOfYear = new Date(Number(year), 11, 31, 23, 59, 59, 999);\r\n\r\n    console.log('Exporting by year:', {\r\n      year,\r\n      startDate: startOfYear.toISOString(),\r\n      endDate: endOfYear.toISOString()\r\n    });\r\n    \r\n    filter.createdAt = {\r\n      $gte: startOfYear,\r\n      $lte: endOfYear\r\n    };\r\n  } else if (startDate && endDate) {\r\n    filter.createdAt = {\r\n      $gte: new Date(startDate as string),\r\n      $lte: new Date(endDate as string)\r\n    };\r\n  }\r\n\r\n  if (period) filter.period = period as string;\r\n  if (employee) filter.employee = employee as string;\r\n  if (labourCard) filter.labourCard = labourCard as string;\r\n\r\n  let searchFilter = {};\r\n  if (search && search.toString().trim()) {\r\n    searchFilter = {\r\n      $or: [\r\n        { period: { $regex: search, $options: 'i' } },\r\n        { labourCard: { $regex: search, $options: 'i' } },\r\n        { labourCardPersonalNo: { $regex: search, $options: 'i' } },\r\n        { remark: { $regex: search, $options: 'i' } }\r\n      ]\r\n    };\r\n  }\r\n\r\n  const finalFilter = Object.keys(searchFilter).length > 0\r\n    ? { ...filter, ...searchFilter }\r\n    : filter;\r\n\r\n  const payrolls = await Payroll.find(finalFilter)\r\n    .sort({ period: -1, createdAt: -1 })\r\n    .populate<{ employee: IUser }>({\r\n      path: 'employee',\r\n      select: 'firstName lastName role emiratesId'\r\n    });\r\n\r\n  if (payrolls.length === 0) {\r\n    return res.status(404).json({\r\n      success: false,\r\n      message: \"No payroll records found for specified criteria\"\r\n    });\r\n  }\r\n\r\n  const workbook = new ExcelJS.Workbook();\r\n  const worksheet = workbook.addWorksheet('Payroll Report');\r\n\r\n  worksheet.columns = [\r\n    { header: 'S/NO', key: 'serialNo', width: 8 },\r\n    { header: 'NAME', key: 'name', width: 25 },\r\n    { header: 'Designation', key: 'designation', width: 20 },\r\n    { header: 'EMIRATES ID', key: 'emiratesId', width: 20 },\r\n    { header: 'LABOUR CARD', key: 'labourCard', width: 20 },\r\n    { header: 'LABOUR CARD PERSONAL NO', key: 'labourCardPersonalNo', width: 25 },\r\n    { header: 'PERIOD', key: 'period', width: 15 },\r\n    { header: 'BASIC SALARY', key: 'basicSalary', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'ALLOWANCE', key: 'allowance', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'TRANSPORT', key: 'transport', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'OVERTIME', key: 'overtime', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'MEDICAL', key: 'medical', width: 15, style: { numFmt: '##0.00' } },\r\n    { header: 'BONUS', key: 'bonus', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'TOTAL EARNING', key: 'totalEarning', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'FOOD ALLOWANCE', key: 'mess', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'SALARY ADVANCE', key: 'salaryAdvance', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'LOAN DEDUCTION', key: 'loanDeduction', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'FINE AMOUNT', key: 'fineAmount', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'VISA DEDUCTION', key: 'visaDeduction', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'TOTAL DEDUCTIONS', key: 'totalDeductions', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'NET', key: 'net', width: 15, style: { numFmt: '#,##0.00' } },\r\n    { header: 'REMARK', key: 'remark', width: 30 }\r\n  ];\r\n\r\n  for (let i = 0; i < payrolls.length; i++) {\r\n    const payroll = payrolls[i];\r\n\r\n    if (!payroll.employee || typeof payroll.employee !== 'object') {\r\n      continue;\r\n    }\r\n\r\n    const employeeExpense = await EmployeeExpense.findOne({\r\n      employee: payroll.employee._id\r\n    }).lean();\r\n\r\n    const basicSalary = employeeExpense?.basicSalary || 0;\r\n    const totalEarnings = basicSalary + payroll.allowance + payroll.transport + payroll.overtime + payroll.medical + payroll.bonus;\r\n    const totalDeductions = payroll.mess + payroll.salaryAdvance + payroll.loanDeduction + payroll.fineAmount + payroll.visaDeduction; // UPDATED\r\n\r\n    worksheet.addRow({\r\n      serialNo: i + 1,\r\n      name: `${payroll.employee.firstName} ${payroll.employee.lastName}`,\r\n      designation: payroll.employee.role,\r\n      emiratesId: payroll.employee.emiratesId || 'N/A',\r\n      labourCard: payroll.labourCard,\r\n      labourCardPersonalNo: payroll.labourCardPersonalNo,\r\n      period: payroll.period,\r\n      basicSalary: employeeExpense?.basicSalary || 0,\r\n      allowance: payroll.allowance,\r\n      transport: payroll.transport,\r\n      overtime: payroll.overtime,\r\n      medical: payroll.medical,\r\n      bonus: payroll.bonus,\r\n      totalEarnings: basicSalary + payroll.allowance + payroll.transport + payroll.overtime + payroll.medical + payroll.bonus,\r\n      mess: payroll.mess,\r\n      salaryAdvance: payroll.salaryAdvance,\r\n      loanDeduction: payroll.loanDeduction,\r\n      fineAmount: payroll.fineAmount,\r\n      visaDeduction: payroll.visaDeduction || 0,\r\n      totalDeductions: payroll.mess + payroll.salaryAdvance + payroll.loanDeduction + payroll.fineAmount + payroll.visaDeduction,\r\n      net: payroll.net,\r\n      remark: payroll.remark || ''\r\n    });\r\n  }\r\n\r\n  let filename = 'payroll_report';\r\n  if (month && year) {\r\n    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',\r\n      'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\r\n    filename += `_${monthNames[Number(month) - 1]}_${year}`;\r\n  } else if (year) {\r\n    filename += `_${year}`;\r\n  } else {\r\n    filename += `_${new Date().toISOString().split('T')[0]}`;\r\n  }\r\n\r\n  res.setHeader(\r\n    'Content-Type',\r\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\r\n  );\r\n  res.setHeader(\r\n    'Content-Disposition',\r\n    `attachment; filename=${filename}.xlsx`\r\n  );\r\n\r\n  await workbook.xlsx.write(res);\r\n  res.end();\r\n});\r\n\r\n// Get single payroll record\r\nexport const getPayroll = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const payroll = await Payroll.findById(id)\r\n    .populate<{ employee: IUser }>({\r\n      path: 'employee',\r\n      select: 'firstName lastName role emiratesId'\r\n    })\r\n    .populate<{ createdBy: IUser }>({\r\n      path: 'createdBy',\r\n      select: 'firstName lastName'\r\n    });\r\n\r\n  if (!payroll) {\r\n    throw new ApiError(404, \"Payroll not found\");\r\n  }\r\n\r\n  if (!payroll.employee || typeof payroll.employee !== 'object') {\r\n    throw new ApiError(500, \"Employee data not properly populated\");\r\n  }\r\n\r\n  const employeeExpense = await EmployeeExpense.findOne({\r\n    employee: payroll.employee._id\r\n  }).lean();\r\n\r\n  // Get attendance details - DON'T pass period since we're filtering by month/year\r\n  const attendanceDetails = await getAttendanceDetailsByMonthYear(\r\n    payroll.employee._id, \r\n    getMonthNumber(payroll.period.split('-')[0]),\r\n    parseInt(payroll.period.split('-')[1])\r\n  );\r\n\r\n  const totalEarnings = (employeeExpense?.basicSalary || 0) +\r\n    payroll.allowance +\r\n    payroll.transport +\r\n    payroll.overtime +\r\n    payroll.medical +\r\n    payroll.bonus;\r\n\r\n  const totalDeductions = payroll.mess +\r\n    payroll.salaryAdvance +\r\n    payroll.loanDeduction +\r\n    payroll.fineAmount +\r\n    payroll.visaDeduction;\r\n\r\n  const enhancedPayroll = {\r\n    ...payroll.toObject(),\r\n    name: `${payroll.employee.firstName} ${payroll.employee.lastName}`,\r\n    designation: payroll.employee.role,\r\n    emiratesId: payroll.employee.emiratesId || 'N/A',\r\n    basicSalary: employeeExpense?.basicSalary || 0,\r\n    totalEarnings,\r\n    totalDeductions,\r\n    // Include attendance summary with Sunday tracking\r\n    attendanceSummary: attendanceDetails.summary,\r\n    createdByName: payroll.createdBy\r\n      ? `${payroll.createdBy.firstName} ${payroll.createdBy.lastName}`\r\n      : 'System'\r\n  };\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(200, enhancedPayroll, \"Payroll retrieved successfully\")\r\n  );\r\n});\r\n\r\n// Helper function to convert number to words\r\nconst convertToWords = (num: number): string => {\r\n  const ones = ['', 'ONE', 'TWO', 'THREE', 'FOUR', 'FIVE', 'SIX', 'SEVEN', 'EIGHT', 'NINE'];\r\n  const tens = ['', '', 'TWENTY', 'THIRTY', 'FORTY', 'FIFTY', 'SIXTY', 'SEVENTY', 'EIGHTY', 'NINETY'];\r\n  const teens = ['TEN', 'ELEVEN', 'TWELVE', 'THIRTEEN', 'FOURTEEN', 'FIFTEEN', 'SIXTEEN', 'SEVENTEEN', 'EIGHTEEN', 'NINETEEN'];\r\n\r\n  if (num === 0) return 'ZERO';\r\n\r\n  const convertLessThanThousand = (n: number): string => {\r\n    if (n === 0) return '';\r\n\r\n    if (n < 10) return ones[n];\r\n    if (n < 20) return teens[n - 10];\r\n    if (n < 100) return tens[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + ones[n % 10] : '');\r\n\r\n    return ones[Math.floor(n / 100)] + ' HUNDRED' + (n % 100 !== 0 ? ' ' + convertLessThanThousand(n % 100) : '');\r\n  };\r\n\r\n  const integerPart = Math.floor(num);\r\n  const decimalPart = Math.round((num - integerPart) * 100);\r\n\r\n  let result = '';\r\n\r\n  if (integerPart >= 1000) {\r\n    result += convertLessThanThousand(Math.floor(integerPart / 1000)) + ' THOUSAND ';\r\n    result += convertLessThanThousand(integerPart % 1000);\r\n  } else {\r\n    result += convertLessThanThousand(integerPart);\r\n  }\r\n\r\n  if (decimalPart > 0) {\r\n    result += ' AND ' + convertLessThanThousand(decimalPart) + ' FILS';\r\n  }\r\n\r\n  return result.trim() + ' AED';\r\n};\r\n\r\n// Generate HTML for payslip with professional header\r\nconst generatePayslipHTML = (data: any): string => {\r\n  console.log(data.attendanceDetails.records[0]);\r\n\r\n  const getStatusDisplay = (record: any) => {\r\n    if (record.status.toLowerCase() === 'day off') {\r\n      return 'status-dayoff';\r\n    }\r\n    return '';\r\n  };\r\n\r\n  const attendanceRows = data.attendanceDetails.records\r\n    .map((record: any) => {\r\n      const status = record.status?.toLowerCase();\r\n      if (status === 'present' || status === 'absent') {\r\n        return '';\r\n      }\r\n\r\n      return `\r\n      <tr${record.isSunday ? ' style=\"background-color: #fff3cd;\"' : ''}>\r\n        <td>${record.sno}</td>\r\n        <td>${record.date}</td>\r\n        <td><strong>${record.day}</strong></td>\r\n        <td class=\"${getStatusDisplay(record)}\">${record.status}</td>\r\n        <td>${status === 'day off' ? '0' : record.hours}</td>\r\n        <td>${status === 'day off' ? '0' : record.overtimeHours}</td>\r\n      </tr>\r\n    `;\r\n    })\r\n    .join('');\r\n\r\n  return `\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Payslip - ${data.period}</title>\r\n    <style>\r\n        @page {\r\n          size: A4;\r\n          margin: 0.3cm;\r\n        }\r\n        \r\n        body {\r\n            font-family: 'Arial', sans-serif;\r\n            font-size: 10pt;\r\n            line-height: 1.3;\r\n            color: #333;\r\n            margin: 0;\r\n            padding: 0;\r\n            background: white;\r\n        }\r\n        \r\n        .payslip-container {\r\n            max-width: 800px;\r\n            margin: 0 auto;\r\n            background: white;\r\n        }\r\n        \r\n        .header {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            margin-bottom: 10px;\r\n            gap: 15px;\r\n            page-break-after: avoid;\r\n            padding: 10px 0;\r\n            border-bottom: 2px solid #94d7f4;\r\n            position: relative;\r\n        }\r\n\r\n        .logo {\r\n            height: 40px;\r\n            width: auto;\r\n            max-width: 120px;\r\n            object-fit: contain;\r\n            position: absolute;\r\n            left: 0;\r\n        }\r\n\r\n        .company-names {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            justify-content: center;\r\n            text-align: center;\r\n            flex-grow: 1;\r\n        }\r\n\r\n        .company-name-arabic {\r\n            font-size: 16pt;\r\n            font-weight: bold;\r\n            color: #1a1a1a;\r\n            line-height: 1.2;\r\n            direction: rtl;\r\n            unicode-bidi: bidi-override;\r\n            letter-spacing: 0;\r\n            margin-bottom: 3px;\r\n        }\r\n\r\n        .company-name-english {\r\n            font-size: 9pt;\r\n            font-weight: bold;\r\n            color: #1a1a1a;\r\n            line-height: 1.2;\r\n            letter-spacing: 0.06em;\r\n            text-transform: uppercase;\r\n        }\r\n        \r\n        .document-title {\r\n            text-align: center;\r\n            margin: 10px 0 15px 0;\r\n            padding: 8px;\r\n            background: linear-gradient(135deg, #2c5aa0 0%, #4a90e2 100%);\r\n            color: white;\r\n            border-radius: 6px;\r\n            font-size: 12pt;\r\n            font-weight: bold;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n            page-break-after: avoid;\r\n        }\r\n        \r\n        .content {\r\n            padding: 0 15px 15px 15px;\r\n        }\r\n        \r\n        .section {\r\n            margin-bottom: 12px;\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .section-title {\r\n            font-size: 10pt;\r\n            font-weight: bold;\r\n            color: #2c5aa0;\r\n            margin-bottom: 8px;\r\n            padding-bottom: 4px;\r\n            border-bottom: 1px solid #e8f4fd;\r\n            text-transform: uppercase;\r\n            page-break-after: avoid;\r\n        }\r\n        \r\n        .info-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(2, 1fr);\r\n            gap: 4px 12px;\r\n            margin-bottom: 8px;\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .info-item {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            padding: 4px 0;\r\n            border-bottom: 1px solid #f5f5f5;\r\n            font-size: 9pt;\r\n        }\r\n        \r\n        .info-label {\r\n            color: #666;\r\n            font-weight: 500;\r\n        }\r\n        \r\n        .info-value {\r\n            color: #333;\r\n            font-weight: 600;\r\n        }\r\n        \r\n        .salary-table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            margin: 10px 0;\r\n            border: 1px solid #ddd;\r\n            font-size: 9pt;\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .salary-table th {\r\n            background: #2c5aa0;\r\n            color: white;\r\n            padding: 8px 6px;\r\n            text-align: left;\r\n            font-weight: 600;\r\n            border: 1px solid #2c5aa0;\r\n        }\r\n        \r\n        .salary-table td {\r\n            padding: 6px 6px;\r\n            border: 1px solid #ddd;\r\n            color: #333;\r\n        }\r\n        \r\n        .amount {\r\n            text-align: right;\r\n            font-weight: 600;\r\n            font-family: 'Courier New', monospace;\r\n        }\r\n        \r\n        .summary-section {\r\n            background: #f8fbff;\r\n            padding: 10px;\r\n            border-radius: 4px;\r\n            margin: 10px 0;\r\n            border: 1px solid #e8f4fd;\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .summary-row {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            padding: 5px 0;\r\n            font-size: 10pt;\r\n        }\r\n        \r\n        .summary-row.total {\r\n            border-top: 1px solid #2c5aa0;\r\n            margin-top: 5px;\r\n            padding-top: 6px;\r\n            font-weight: 700;\r\n            color: #2c5aa0;\r\n        }\r\n        \r\n        .net-pay {\r\n            background: linear-gradient(135deg, #2c5aa0 0%, #4a90e2 100%);\r\n            color: white;\r\n            padding: 12px;\r\n            text-align: center;\r\n            margin: 12px 0;\r\n            border-radius: 6px;\r\n            box-shadow: 0 1px 4px rgba(0,0,0,0.1);\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .net-pay-label {\r\n            font-size: 10pt;\r\n            opacity: 0.95;\r\n            margin-bottom: 5px;\r\n            font-weight: 600;\r\n        }\r\n        \r\n        .net-pay-amount {\r\n            font-size: 18px;\r\n            font-weight: 700;\r\n            font-family: 'Courier New', monospace;\r\n            letter-spacing: 0.5px;\r\n        }\r\n        \r\n        .attendance-summary {\r\n            background: #f8fbff;\r\n            padding: 10px;\r\n            border-radius: 4px;\r\n            margin: 10px 0;\r\n            border: 1px solid #e8f4fd;\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .attendance-summary-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(4, 1fr);\r\n            gap: 8px;\r\n            text-align: center;\r\n        }\r\n        \r\n        .summary-card {\r\n            padding: 10px;\r\n            background: white;\r\n            border-radius: 4px;\r\n            border: 1px solid #e8f4fd;\r\n            box-shadow: 0 1px 2px rgba(0,0,0,0.1);\r\n        }\r\n        \r\n        .sunday-card {\r\n            padding: 10px;\r\n            background: #fff9e6;\r\n            border-radius: 4px;\r\n            border: 1px solid #ffc107;\r\n            box-shadow: 0 1px 2px rgba(0,0,0,0.1);\r\n        }\r\n        \r\n        .summary-card h4 {\r\n            margin: 0 0 6px 0;\r\n            font-size: 8pt;\r\n            font-weight: 600;\r\n            color: #2c5aa0;\r\n            text-transform: uppercase;\r\n        }\r\n        \r\n        .sunday-card h4 {\r\n            margin: 0 0 6px 0;\r\n            font-size: 8pt;\r\n            font-weight: 600;\r\n            color: #856404;\r\n            text-transform: uppercase;\r\n        }\r\n        \r\n        .summary-value {\r\n            font-size: 14px;\r\n            font-weight: 700;\r\n            color: #2c5aa0;\r\n            margin-bottom: 2px;\r\n        }\r\n        \r\n        .sunday-value {\r\n            font-size: 14px;\r\n            font-weight: 700;\r\n            color: #856404;\r\n            margin-bottom: 2px;\r\n        }\r\n        \r\n        .summary-label {\r\n            font-size: 8pt;\r\n            color: #666;\r\n            font-weight: 500;\r\n        }\r\n        \r\n        .sunday-label {\r\n            font-size: 8pt;\r\n            color: #856404;\r\n            font-weight: 500;\r\n        }\r\n        \r\n        .attendance-table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            margin: 10px 0;\r\n            border: 1px solid #ddd;\r\n            font-size: 8pt;\r\n            page-break-inside: avoid;\r\n        }\r\n        \r\n        .attendance-table th {\r\n            background: #2c5aa0;\r\n            color: white;\r\n            padding: 6px 4px;\r\n            text-align: center;\r\n            font-weight: 600;\r\n            border: 1px solid #2c5aa0;\r\n        }\r\n        \r\n        .attendance-table td {\r\n            padding: 4px 4px;\r\n            border: 1px solid #ddd;\r\n            color: #333;\r\n            text-align: center;\r\n        }\r\n        \r\n        .footer {\r\n            background: #f8f9fa;\r\n            padding: 10px 15px;\r\n            text-align: center;\r\n            font-size: 8pt;\r\n            color: #666;\r\n            border-top: 1px solid #e9ecef;\r\n            margin-top: 15px;\r\n            page-break-inside: avoid;\r\n        }\r\n\r\n        .status-dayoff {\r\n            color: #6c757d;\r\n            font-weight: 600;\r\n        }\r\n\r\n        .tagline {\r\n            text-align: center;\r\n            font-weight: bold;\r\n            font-size: 10pt;\r\n            margin: 15px 0 8px 0;\r\n            color: #2c5aa0;\r\n            padding-top: 8px;\r\n            border-top: 1px solid #e9ecef;\r\n            page-break-inside: avoid;\r\n        }\r\n\r\n        .page-break {\r\n            page-break-before: always;\r\n        }\r\n\r\n        .no-break {\r\n            page-break-inside: avoid;\r\n        }\r\n\r\n        .compact {\r\n            margin-bottom: 8px;\r\n        }\r\n\r\n        @media print {\r\n            body {\r\n                background: white;\r\n                margin: 0;\r\n                padding: 0;\r\n            }\r\n            \r\n            .payslip-container {\r\n                margin: 0;\r\n            }\r\n            \r\n            .content {\r\n                padding: 0 10px 10px 10px;\r\n            }\r\n            \r\n            .document-title {\r\n                margin: 8px 0 12px 0;\r\n            }\r\n\r\n            .section {\r\n                margin-bottom: 8px;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"payslip-container\">\r\n        <div class=\"header\">\r\n            <img class=\"logo\" src=\"https://agats.s3.ap-south-1.amazonaws.com/logo/alghlogo.jpg\" alt=\"Company Logo\">\r\n            <div class=\"company-names\">\r\n                <div class=\"company-name-arabic\">   </div>\r\n                <div class=\"company-name-english\">AL GHAZAL AL ABYAD TECHNICAL SERVICES</div>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class=\"document-title\">\r\n            SALARY SLIP FOR THE MONTH OF ${data.periodText}\r\n        </div>\r\n        \r\n        <div class=\"content\">\r\n            <!-- Employee Information Section -->\r\n            <div class=\"section no-break\">\r\n                <div class=\"section-title\">Employee Information</div>\r\n                <div class=\"info-grid\">\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Employee Name</span>\r\n                        <span class=\"info-value\">${data.employeeName}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Designation</span>\r\n                        <span class=\"info-value\">${data.designation}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Bank Name</span>\r\n                        <span class=\"info-value\">${data.bankName || 'N/A'}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">IBAN Number</span>\r\n                        <span class=\"info-value\">${data.ibanNumber}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Passport Number</span>\r\n                        <span class=\"info-value\">${data.passportNumber}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Passport Expiry</span>\r\n                        <span class=\"info-value\">${data.passportExpiry || 'N/A'}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Labour Card Number</span>\r\n                        <span class=\"info-value\">${data.labourCard}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Labour Card Personal Number</span>\r\n                        <span class=\"info-value\">${data.labourCardPersonalNo}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Labour Card Expiry</span>\r\n                        <span class=\"info-value\">${data.labourCardExpiry || 'N/A'}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Emirates ID</span>\r\n                        <span class=\"info-value\">${data.emiratesId}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Emirates ID Expiry</span>\r\n                        <span class=\"info-value\">${data.emiratesIdExpiry || 'N/A'}</span>\r\n                    </div>\r\n                    <div class=\"info-item\">\r\n                        <span class=\"info-label\">Working Days</span>\r\n                        <span class=\"info-value\">${data.attendanceDetails.summary.presentDays} Days</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Salary Details Section -->\r\n            <div class=\"section no-break\">\r\n                <div class=\"section-title\">Salary Details</div>\r\n                <table class=\"salary-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th style=\"width: 25%;\">EARNINGS</th>\r\n                            <th style=\"width: 15%;\" class=\"amount\">AMOUNT (AED)</th>\r\n                            <th style=\"width: 25%;\">DEDUCTIONS</th>\r\n                            <th style=\"width: 15%;\" class=\"amount\">AMOUNT (AED)</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <tr>\r\n                            <td>Basic Salary</td>\r\n                            <td class=\"amount\">${data.basicSalary.toFixed(2)}</td>\r\n                            <td>Food Allowance</td>\r\n                            <td class=\"amount\">${data.mess.toFixed(2)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>Allowance</td>\r\n                            <td class=\"amount\">${data.allowance.toFixed(2)}</td>\r\n                            <td>Salary Advance</td>\r\n                            <td class=\"amount\">${data.salaryAdvance.toFixed(2)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>Transport</td>\r\n                            <td class=\"amount\">${data.transport.toFixed(2)}</td>\r\n                            <td>Loan Deduction</td>\r\n                            <td class=\"amount\">${data.loanDeduction.toFixed(2)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>Overtime</td>\r\n                            <td class=\"amount\">${data.overtime.toFixed(2)}</td>\r\n                            <td>Fine Amount</td>\r\n                            <td class=\"amount\">${data.fineAmount.toFixed(2)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>Special OT</td>\r\n                            <td class=\"amount\">${data.specialOT.toFixed(2)}</td>\r\n                            <td>Visa Deduction</td>\r\n                            <td class=\"amount\">${data.visaDeduction.toFixed(2)}</td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>Medical</td>\r\n                            <td class=\"amount\">${data.medical.toFixed(2)}</td>\r\n                            <td></td>\r\n                            <td class=\"amount\"></td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>Bonus</td>\r\n                            <td class=\"amount\">${data.bonus.toFixed(2)}</td>\r\n                            <td></td>\r\n                            <td class=\"amount\"></td>\r\n                        </tr>\r\n                    </tbody>\r\n                </table>\r\n                \r\n                <div class=\"summary-section\">\r\n                    <div class=\"summary-row\">\r\n                        <span>Total Earnings</span>\r\n                        <span style=\"font-weight: 600;\">${data.totalEarnings.toFixed(2)} AED</span>\r\n                    </div>\r\n                    <div class=\"summary-row\">\r\n                        <span>Total Deductions</span>\r\n                        <span style=\"font-weight: 600;\">${data.totalDeductions.toFixed(2)} AED</span>\r\n                    </div>\r\n                    <div class=\"summary-row total\">\r\n                        <span>NET PAY</span>\r\n                        <span>${data.net.toFixed(2)} AED</span>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div class=\"net-pay\">\r\n                    <div class=\"net-pay-label\">AMOUNT IN WORDS</div>\r\n                    <div class=\"net-pay-amount\">${data.netInWords}</div>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Attendance Summary Section -->\r\n            <div class=\"section no-break\">\r\n                <div class=\"section-title\">Attendance Summary</div>\r\n                <div class=\"attendance-summary\">\r\n                    <div class=\"attendance-summary-grid\">\r\n                        <div class=\"summary-card\">\r\n                            <h4>Total Working Days</h4>\r\n                            <div class=\"summary-value\">${data.attendanceDetails.summary.presentDays}</div>\r\n                            <div class=\"summary-label\">Days</div>\r\n                        </div>\r\n                        \r\n                        <div class=\"summary-card\">\r\n                            <h4>Regular Hours</h4>\r\n                            <div class=\"summary-value\">${data.attendanceDetails.summary.totalHours}</div>\r\n                            <div class=\"summary-label\">Hours</div>\r\n                        </div>\r\n                        \r\n                        <div class=\"summary-card\">\r\n                            <h4>Overtime Hours</h4>\r\n                            <div class=\"summary-value\">${data.attendanceDetails.summary.overtimeHours}</div>\r\n                            <div class=\"summary-label\">Hours</div>\r\n                        </div>\r\n                        \r\n                        ${data.attendanceDetails.summary.sundayWorkingDays > 0 ? `\r\n                        <div class=\"sunday-card\">\r\n                            <h4> Sunday Working</h4>\r\n                            <div class=\"sunday-value\">${data.attendanceDetails.summary.sundayWorkingDays}</div>\r\n                            <div class=\"sunday-label\">Days</div>\r\n                        </div>\r\n                        ` : `\r\n                        <div class=\"summary-card\" style=\"opacity: 0.6;\">\r\n                            <h4>Sunday Working</h4>\r\n                            <div class=\"summary-value\">0</div>\r\n                            <div class=\"summary-label\">Days</div>\r\n                        </div>\r\n                        `}\r\n                    </div>\r\n                    \r\n                    ${data.attendanceDetails.summary.sundayOvertimeHours > 0 ? `\r\n                    <div style=\"margin-top: 8px; text-align: center;\">\r\n                        <div style=\"display: inline-block; background: #fff9e6; padding: 6px 12px; border-radius: 3px; border: 1px solid #ffc107;\">\r\n                            <strong style=\"color: #856404; font-size: 8pt;\">Sunday Overtime Hours: ${data.attendanceDetails.summary.sundayOvertimeHours} Hours</strong>\r\n                        </div>\r\n                    </div>\r\n                    ` : ''}\r\n                </div>\r\n                \r\n                <table class=\"attendance-table\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th style=\"width: 8%;\">S.NO</th>\r\n                            <th style=\"width: 15%;\">DATE</th>\r\n                            <th style=\"width: 15%;\">DAY</th>\r\n                            <th style=\"width: 12%;\">STATUS</th>\r\n                            <th style=\"width: 15%;\">REGULAR HOURS</th>\r\n                            <th style=\"width: 15%;\">OT HOURS</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        ${attendanceRows}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            \r\n            ${data.remark ? `\r\n            <div class=\"section no-break\">\r\n                <div class=\"section-title\">Remarks</div>\r\n                <div style=\"color: #666; font-size: 9pt; padding: 8px; background: #f8f9fa; border-radius: 3px; border-left: 3px solid #2c5aa0;\">\r\n                    ${data.remark}\r\n                </div>\r\n            </div>\r\n            ` : ''}\r\n\r\n            <div class=\"tagline\">We work U Relax</div>\r\n        </div>\r\n        \r\n        <div class=\"footer\">\r\n            <p><strong>Note:</strong> This is a computer-generated payslip and does not require a signature.</p>\r\n            <p style=\"margin-top: 3px;\"><em>Sunday working days are highlighted in yellow in the attendance table.</em></p>\r\n            <p style=\"margin-top: 5px;\"><strong>AL GHAZAL AL ABYAD TECHNICAL SERVICES</strong></p>\r\n            <p>Office No:04, R09-France Cluster, International City-Dubai | P.O.Box:262760, Dubai-U.A.E</p>\r\n            <p>Tel: 044102555 | <a href=\"http://www.alghazalgroup.com/\">www.alghazalgroup.com</a></p>\r\n            <p style=\"margin-top: 6px;\">Generated on ${new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })}</p>\r\n        </div>\r\n    </div>\r\n</body>\r\n</html>\r\n  `;\r\n};\r\n\r\n// Generate payslip PDF\r\nexport const generatePayslipPDF = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const payroll = await Payroll.findById(id).populate<{ employee: IUser }>({\r\n    path: 'employee',\r\n    select: 'firstName lastName role emiratesId passportNumber iBANNumber'\r\n  });\r\n\r\n  if (!payroll) {\r\n    throw new ApiError(404, \"Payroll record not found\");\r\n  }\r\n\r\n  if (!payroll.employee || typeof payroll.employee !== 'object') {\r\n    throw new ApiError(500, \"Employee data not properly populated\");\r\n  }\r\n\r\n  const employeeExpense = await EmployeeExpense.findOne({\r\n    employee: payroll.employee._id\r\n  }).lean();\r\n\r\n  // Get visa expense data for additional employee information\r\n  const visaExpense = await VisaExpense.findOne({\r\n    employee: payroll.employee._id\r\n  }).lean();\r\n\r\n  const basicSalary = employeeExpense?.basicSalary || 0;\r\n  const totalEarnings = basicSalary + payroll.allowance + payroll.transport +\r\n    payroll.overtime + payroll.specialOT + payroll.medical + payroll.bonus;\r\n  const totalDeductions = payroll.mess + payroll.salaryAdvance +\r\n    payroll.loanDeduction + payroll.fineAmount + payroll.visaDeduction; // UPDATED\r\n\r\n  const attendanceDetails = await getAttendanceDetails(payroll.employee._id, payroll.period);\r\n\r\n  const [month, year] = payroll.period.split('-');\r\n  const monthNames = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',\r\n    'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'];\r\n  const periodText = `${monthNames[parseInt(month) - 1]} ${year}`;\r\n\r\n  // Format date function\r\n  const formatDate = (date: Date | string | undefined): string => {\r\n    if (!date) return 'N/A';\r\n    const d = new Date(date);\r\n    return isNaN(d.getTime()) ? 'N/A' : d.toLocaleDateString('en-GB', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n\r\n  const payslipData = {\r\n    employeeName: `${payroll.employee.firstName} ${payroll.employee.lastName}`.toUpperCase(),\r\n    designation: payroll.employee.role.toUpperCase(),\r\n    emiratesId: payroll.employee.emiratesId || 'N/A',\r\n    emiratesIdExpiry: formatDate(visaExpense?.emirateIdExpireDate),\r\n    passportNumber: payroll.employee.passportNumber || 'N/A',\r\n    passportExpiry: formatDate(visaExpense?.passportExpireDate),\r\n    ibanNumber: payroll.employee.iBANNumber || 'N/A',\r\n    bankName: 'Emirates NBD',\r\n    labourCard: payroll.labourCard,\r\n    labourCardPersonalNo: payroll.labourCardPersonalNo,\r\n    labourCardExpiry: formatDate(visaExpense?.labourExpireDate),\r\n    period: payroll.period,\r\n    periodText,\r\n    basicSalary,\r\n    allowance: payroll.allowance,\r\n    transport: payroll.transport,\r\n    overtime: payroll.overtime,\r\n    specialOT: payroll.specialOT || 0,\r\n    medical: payroll.medical,\r\n    bonus: payroll.bonus,\r\n    mess: payroll.mess,\r\n    salaryAdvance: payroll.salaryAdvance,\r\n    loanDeduction: payroll.loanDeduction,\r\n    fineAmount: payroll.fineAmount,\r\n    visaDeduction: payroll.visaDeduction || 0, // NEW FIELD\r\n    totalEarnings,\r\n    totalDeductions,\r\n    net: payroll.net,\r\n    netInWords: convertToWords(payroll.net),\r\n    remark: payroll.remark,\r\n    attendanceDetails\r\n  };\r\n\r\n  const html = generatePayslipHTML(payslipData);\r\n\r\n  const browser = await puppeteer.launch({\r\n    headless: \"shell\",\r\n    args: ['--no-sandbox', '--disable-setuid-sandbox', '--font-render-hinting=none']\r\n  });\r\n\r\n  try {\r\n    const page = await browser.newPage();\r\n    await page.setViewport({ width: 1200, height: 1600 });\r\n\r\n    await page.setContent(html, {\r\n      waitUntil: ['load', 'networkidle0', 'domcontentloaded'],\r\n      timeout: 30000\r\n    });\r\n\r\n    const pdfBuffer = await page.pdf({\r\n      format: 'A4',\r\n      printBackground: true,\r\n      margin: {\r\n        top: '0.3cm',\r\n        right: '0.3cm',\r\n        bottom: '0.3cm',\r\n        left: '0.3cm'\r\n      },\r\n      displayHeaderFooter: false,\r\n      preferCSSPageSize: true\r\n    });\r\n\r\n    const filename = `payslip_${payroll.employee.firstName}_${payroll.employee.lastName}_${payroll.period}.pdf`;\r\n\r\n    res.setHeader('Content-Type', 'application/pdf');\r\n    res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\r\n    res.send(pdfBuffer);\r\n  } catch (error) {\r\n    console.error(\"PDF generation error:\", error);\r\n    throw new ApiError(500, \"Failed to generate PDF\");\r\n  } finally {\r\n    await browser.close();\r\n  }\r\n});\r\n\r\n// Get payslip data (preview without PDF generation)\r\nexport const getPayslipData = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const payroll = await Payroll.findById(id).populate<{ employee: IUser }>({\r\n    path: 'employee',\r\n    select: 'firstName lastName role emiratesId passportNumber iBANNumber'\r\n  });\r\n\r\n  if (!payroll) {\r\n    throw new ApiError(404, \"Payroll record not found\");\r\n  }\r\n\r\n  if (!payroll.employee || typeof payroll.employee !== 'object') {\r\n    throw new ApiError(500, \"Employee data not properly populated\");\r\n  }\r\n\r\n  const employeeExpense = await EmployeeExpense.findOne({\r\n    employee: payroll.employee._id\r\n  }).lean();\r\n\r\n  const basicSalary = employeeExpense?.basicSalary || 0;\r\n  const totalEarnings = basicSalary + payroll.allowance + payroll.transport +\r\n    payroll.overtime + payroll.specialOT + payroll.medical + payroll.bonus;\r\n  const totalDeductions = payroll.mess + payroll.salaryAdvance +\r\n    payroll.loanDeduction + payroll.fineAmount + payroll.visaDeduction; // UPDATED\r\n\r\n  const attendanceDetails = await getAttendanceDetails(payroll.employee._id, payroll.period);\r\n\r\n  const [month, year] = payroll.period.split('-');\r\n  const monthNames = ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',\r\n    'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'];\r\n  const periodText = `${monthNames[parseInt(month) - 1]} ${year}`;\r\n\r\n  const payslipData = {\r\n    employeeName: `${payroll.employee.firstName} ${payroll.employee.lastName}`,\r\n    designation: payroll.employee.role,\r\n    emiratesId: payroll.employee.emiratesId || 'N/A',\r\n    passportNumber: payroll.employee.passportNumber || 'N/A',\r\n    ibanNumber: payroll.employee.iBANNumber || 'N/A',\r\n    labourCard: payroll.labourCard,\r\n    labourCardPersonalNo: payroll.labourCardPersonalNo,\r\n    period: payroll.period,\r\n    periodText,\r\n    basicSalary,\r\n    allowance: payroll.allowance,\r\n    transport: payroll.transport,\r\n    overtime: payroll.overtime,\r\n    specialOT: payroll.specialOT || 0,\r\n    medical: payroll.medical,\r\n    bonus: payroll.bonus,\r\n    mess: payroll.mess,\r\n    salaryAdvance: payroll.salaryAdvance,\r\n    loanDeduction: payroll.loanDeduction,\r\n    fineAmount: payroll.fineAmount,\r\n    visaDeduction: payroll.visaDeduction || 0, // NEW FIELD\r\n    totalEarnings,\r\n    totalDeductions,\r\n    net: payroll.net,\r\n    netInWords: convertToWords(payroll.net),\r\n    remark: payroll.remark,\r\n    attendanceDetails\r\n  };\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(200, payslipData, \"Payslip data retrieved successfully\")\r\n  );\r\n});"]}