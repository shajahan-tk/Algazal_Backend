{"version":3,"file":"visaExpenseController.js","sourceRoot":"","sources":["../../src/controllers/visaExpenseController.ts"],"names":[],"mappings":"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","sourcesContent":["import { Request, Response } from \"express\";\r\nimport { asyncHandler } from \"../utils/asyncHandler\";\r\nimport { ApiResponse } from \"../utils/apiHandlerHelpers\";\r\nimport { ApiError } from \"../utils/apiHandlerHelpers\";\r\nimport { VisaExpense } from \"../models/visaExpenseModel\";\r\nimport { User } from \"../models/userModel\";\r\nimport ExcelJS from \"exceljs\";\r\n\r\nexport const createVisaExpense = asyncHandler(async (req: Request, res: Response) => {\r\n  const {\r\n    employee,\r\n    iBan,\r\n    passportNumber,\r\n    passportExpireDate,\r\n    emirateIdNumber,\r\n    emirateIdExpireDate,\r\n    labourCardPersonalNumber,\r\n    workPermitNumber,\r\n    labourExpireDate,\r\n    offerLetterTyping = 0,\r\n    labourInsurance = 0,\r\n    labourCardPayment = 0,\r\n    statusChangeInOut = 0,\r\n    insideEntry = 0,\r\n    medicalSharjah = 0,\r\n    tajweehSubmission = 0,\r\n    iloeInsurance = 0,\r\n    healthInsurance = 0,\r\n    emirateId = 0,\r\n    residenceStamping = 0,\r\n    srilankaCouncilHead = 0,\r\n    upscoding = 0,\r\n    labourFinePayment = 0,\r\n    labourCardRenewalPayment = 0,\r\n    servicePayment = 0,\r\n    visaStamping = 0,\r\n    twoMonthVisitingVisa = 0,\r\n    finePayment = 0,\r\n    entryPermitOutside = 0,\r\n    complaintEmployee = 0,\r\n    arabicLetter = 0,\r\n    violationCommittee = 0,\r\n    quotaModification = 0,\r\n    others = 0,\r\n  } = req.body;\r\n\r\n  // Validate required fields\r\n  if (!employee) {\r\n    throw new ApiError(400, \"Employee is a required field\");\r\n  }\r\n\r\n  // Check if employee exists\r\n  const employeeExists = await User.findById(employee);\r\n  if (!employeeExists) {\r\n    throw new ApiError(404, \"Employee not found\");\r\n  }\r\n\r\n  // Calculate total safely by converting to numbers first\r\n  const total = Number(offerLetterTyping) +\r\n    Number(labourInsurance) +\r\n    Number(labourCardPayment) +\r\n    Number(statusChangeInOut) +\r\n    Number(insideEntry) +\r\n    Number(medicalSharjah) +\r\n    Number(tajweehSubmission) +\r\n    Number(iloeInsurance) +\r\n    Number(healthInsurance) +\r\n    Number(emirateId) +\r\n    Number(residenceStamping) +\r\n    Number(srilankaCouncilHead) +\r\n    Number(upscoding) +\r\n    Number(labourFinePayment) +\r\n    Number(labourCardRenewalPayment) +\r\n    Number(servicePayment) +\r\n    Number(visaStamping) +\r\n    Number(twoMonthVisitingVisa) +\r\n    Number(finePayment) +\r\n    Number(entryPermitOutside) +\r\n    Number(complaintEmployee) +\r\n    Number(arabicLetter) +\r\n    Number(violationCommittee) +\r\n    Number(quotaModification) +\r\n    Number(others);\r\n\r\n  // Create visa expense\r\n  const visaExpense = await VisaExpense.create({\r\n    employee,\r\n    iBan,\r\n    passportNumber,\r\n    passportExpireDate: passportExpireDate ? new Date(passportExpireDate) : undefined,\r\n    emirateIdNumber,\r\n    emirateIdExpireDate: emirateIdExpireDate ? new Date(emirateIdExpireDate) : undefined,\r\n    labourCardPersonalNumber,\r\n    workPermitNumber,\r\n    labourExpireDate: labourExpireDate ? new Date(labourExpireDate) : undefined,\r\n    offerLetterTyping: Number(offerLetterTyping),\r\n    labourInsurance: Number(labourInsurance),\r\n    labourCardPayment: Number(labourCardPayment),\r\n    statusChangeInOut: Number(statusChangeInOut),\r\n    insideEntry: Number(insideEntry),\r\n    medicalSharjah: Number(medicalSharjah),\r\n    tajweehSubmission: Number(tajweehSubmission),\r\n    iloeInsurance: Number(iloeInsurance),\r\n    healthInsurance: Number(healthInsurance),\r\n    emirateId: Number(emirateId),\r\n    residenceStamping: Number(residenceStamping),\r\n    srilankaCouncilHead: Number(srilankaCouncilHead),\r\n    upscoding: Number(upscoding),\r\n    labourFinePayment: Number(labourFinePayment),\r\n    labourCardRenewalPayment: Number(labourCardRenewalPayment),\r\n    servicePayment: Number(servicePayment),\r\n    visaStamping: Number(visaStamping),\r\n    twoMonthVisitingVisa: Number(twoMonthVisitingVisa),\r\n    finePayment: Number(finePayment),\r\n    entryPermitOutside: Number(entryPermitOutside),\r\n    complaintEmployee: Number(complaintEmployee),\r\n    arabicLetter: Number(arabicLetter),\r\n    violationCommittee: Number(violationCommittee),\r\n    quotaModification: Number(quotaModification),\r\n    others: Number(others),\r\n    total: Number(total.toFixed(2)), // Ensure we store as a proper number with 2 decimal places\r\n    createdBy: req.user?.userId,\r\n  });\r\n\r\n  res.status(201).json(new ApiResponse(201, visaExpense, \"Visa expense created successfully\"));\r\n});\r\n\r\nexport const getVisaExpenses = asyncHandler(async (req: Request, res: Response) => {\r\n  const page = parseInt(req.query.page as string) || 1;\r\n  const limit = parseInt(req.query.limit as string) || 10;\r\n  const skip = (page - 1) * limit;\r\n\r\n  const filter: any = {};\r\n\r\n  // Employee filter\r\n  if (req.query.employee) {\r\n    filter.employee = req.query.employee;\r\n  }\r\n\r\n  // Date range filter\r\n  if (req.query.startDate && req.query.endDate) {\r\n    filter.createdAt = {\r\n      $gte: new Date(req.query.startDate as string),\r\n      $lte: new Date(req.query.endDate as string),\r\n    };\r\n  }\r\n\r\n  // Total range filter\r\n  if (req.query.minTotal || req.query.maxTotal) {\r\n    filter.total = {};\r\n    if (req.query.minTotal) {\r\n      filter.total.$gte = parseFloat(req.query.minTotal as string);\r\n    }\r\n    if (req.query.maxTotal) {\r\n      filter.total.$lte = parseFloat(req.query.maxTotal as string);\r\n    }\r\n  }\r\n\r\n  const total = await VisaExpense.countDocuments(filter);\r\n\r\n  // Get all visa expenses with employee details\r\n  const visaExpenses = await VisaExpense.find(filter)\r\n    .skip(skip)\r\n    .limit(limit)\r\n    .sort({ createdAt: -1 })\r\n    .populate(\"employee\", \"firstName lastName email phoneNumbers role\")\r\n    .populate(\"createdBy\", \"firstName lastName\");\r\n\r\n  res.status(200).json(\r\n    new ApiResponse(\r\n      200,\r\n      {\r\n        visaExpenses,\r\n        pagination: {\r\n          total,\r\n          page,\r\n          limit,\r\n          totalPages: Math.ceil(total / limit),\r\n          hasNextPage: page * limit < total,\r\n          hasPreviousPage: page > 1,\r\n        },\r\n      },\r\n      \"Visa expenses retrieved successfully\"\r\n    )\r\n  );\r\n});\r\n\r\nexport const getVisaExpense = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const visaExpense = await VisaExpense.findById(id)\r\n    .populate(\"employee\", \"firstName lastName email phoneNumbers role\")\r\n    .populate(\"createdBy\", \"firstName lastName\");\r\n\r\n  if (!visaExpense) {\r\n    throw new ApiError(404, \"Visa expense not found\");\r\n  }\r\n\r\n  res.status(200).json(new ApiResponse(200, visaExpense, \"Visa expense retrieved successfully\"));\r\n});\r\n\r\nexport const updateVisaExpense = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n  const updateData = req.body;\r\n\r\n  // Check if employee exists if being updated\r\n  if (updateData.employee) {\r\n    const employeeExists = await User.findById(updateData.employee);\r\n    if (!employeeExists) {\r\n      throw new ApiError(404, \"Employee not found\");\r\n    }\r\n  }\r\n\r\n  // Convert date fields if they exist in updateData\r\n  if (updateData.passportExpireDate) {\r\n    updateData.passportExpireDate = new Date(updateData.passportExpireDate);\r\n  }\r\n  if (updateData.emirateIdExpireDate) {\r\n    updateData.emirateIdExpireDate = new Date(updateData.emirateIdExpireDate);\r\n  }\r\n  if (updateData.labourExpireDate) {\r\n    updateData.labourExpireDate = new Date(updateData.labourExpireDate);\r\n  }\r\n\r\n  // If any expense fields are being updated, recalculate the total\r\n  const expenseFields = [\r\n    'offerLetterTyping', 'labourInsurance', 'labourCardPayment', 'statusChangeInOut',\r\n    'insideEntry', 'medicalSharjah', 'tajweehSubmission', 'iloeInsurance',\r\n    'healthInsurance', 'emirateId', 'residenceStamping', 'srilankaCouncilHead',\r\n    'upscoding', 'labourFinePayment', 'labourCardRenewalPayment', 'servicePayment',\r\n    'visaStamping', 'twoMonthVisitingVisa', 'finePayment', 'entryPermitOutside',\r\n    'complaintEmployee', 'arabicLetter', 'violationCommittee', 'quotaModification',\r\n    'others'\r\n  ];\r\n\r\n  const shouldRecalculateTotal = expenseFields.some(field => field in updateData);\r\n\r\n  if (shouldRecalculateTotal) {\r\n    // Get the current document\r\n    const currentExpense:any = await VisaExpense.findById(id);\r\n    if (!currentExpense) {\r\n      throw new ApiError(404, \"Visa expense not found\");\r\n    }\r\n    \r\n\r\n    // Calculate new total based on updated values or existing values\r\n    const total = expenseFields.reduce((sum, field) => {\r\n      const value = field in updateData ? Number(updateData[field]) : Number(currentExpense[field]);\r\n      return sum + (isNaN(value) ? 0 : value);\r\n    }, 0);\r\n\r\n    updateData.total = Number(total.toFixed(2));\r\n  }\r\n\r\n  const updatedVisaExpense = await VisaExpense.findByIdAndUpdate(id, updateData, {\r\n    new: true,\r\n  })\r\n    .populate(\"employee\", \"firstName lastName email phoneNumbers role\")\r\n    .populate(\"createdBy\", \"firstName lastName\");\r\n\r\n  if (!updatedVisaExpense) {\r\n    throw new ApiError(404, \"Visa expense not found or update failed\");\r\n  }\r\n\r\n  res.status(200).json(new ApiResponse(200, updatedVisaExpense, \"Visa expense updated successfully\"));\r\n});\r\nexport const deleteVisaExpense = asyncHandler(async (req: Request, res: Response) => {\r\n  const { id } = req.params;\r\n\r\n  const visaExpense = await VisaExpense.findByIdAndDelete(id);\r\n\r\n  if (!visaExpense) {\r\n    throw new ApiError(404, \"Visa expense not found\");\r\n  }\r\n\r\n  res.status(200).json(new ApiResponse(200, null, \"Visa expense deleted successfully\"));\r\n});\r\n\r\nexport const exportVisaExpensesToExcel = asyncHandler(async (req: Request, res: Response) => {\r\n  const filter: any = {};\r\n\r\n  // Employee filter\r\n  if (req.query.employee) {\r\n    filter.employee = req.query.employee;\r\n  }\r\n\r\n  // Date range filter\r\n  if (req.query.startDate && req.query.endDate) {\r\n    filter.createdAt = {\r\n      $gte: new Date(req.query.startDate as string),\r\n      $lte: new Date(req.query.endDate as string),\r\n    };\r\n  }\r\n\r\n  // Get all visa expenses with employee details\r\n  const visaExpenses = await VisaExpense.find(filter)\r\n    .sort({ createdAt: -1 })\r\n    .populate<{\r\n      employee: {\r\n        firstName: string;\r\n        lastName: string;\r\n        phoneNumbers: string[];\r\n        role: string;\r\n      };\r\n    }>(\"employee\", \"firstName lastName phoneNumbers role\");\r\n\r\n  // Create a new workbook\r\n  const workbook = new ExcelJS.Workbook();\r\n  const worksheet = workbook.addWorksheet(\"Visa Expenses\");\r\n\r\n  // Define columns\r\n  const columns = [\r\n    { header: \"Name\", key: \"name\", width: 25 },\r\n    { header: \"Country\", key: \"country\", width: 15 },\r\n    { header: \"Designation\", key: \"designation\", width: 20 },\r\n    { header: \"Bank Number\", key: \"bankNumber\", width: 20 },\r\n    { header: \"IBAN\", key: \"iBan\", width: 25 },\r\n    { header: \"Passport Number\", key: \"passportNumber\", width: 20 },\r\n    { header: \"Expire Date\", key: \"passportExpireDate\", width: 15, style: { numFmt: \"dd-mm-yyyy\" } },\r\n    { header: \"Emirate ID Number\", key: \"emirateIdNumber\", width: 20 },\r\n    { header: \"ID Expire\", key: \"emirateIdExpireDate\", width: 15, style: { numFmt: \"dd-mm-yyyy\" } },\r\n    { header: \"Labour Card Personal Number\", key: \"labourCardPersonalNumber\", width: 25 },\r\n    { header: \"Work Permit Num\", key: \"workPermitNumber\", width: 20 },\r\n    { header: \"Labour Expire Date\", key: \"labourExpireDate\", width: 15, style: { numFmt: \"dd-mm-yyyy\" } },\r\n    { header: \"Offer Letter Typing\", key: \"offerLetterTyping\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Labour Insurance\", key: \"labourInsurance\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Labour Card Payment\", key: \"labourCardPayment\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Status Change In/Out\", key: \"statusChangeInOut\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Inside Entry\", key: \"insideEntry\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Medical Sharjh\", key: \"medicalSharjah\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Tajweeh Submission\", key: \"tajweehSubmission\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"ILOE Insurance\", key: \"iloeInsurance\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Health Insurance\", key: \"healthInsurance\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Emirated ID\", key: \"emirateId\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Residence Stamping (Normal)\", key: \"residenceStamping\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Srilanka Council Head\", key: \"srilankaCouncilHead\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Upscoding\", key: \"upscoding\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Labour Fine Payment\", key: \"labourFinePayment\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Labour Card Renewal Payment\", key: \"labourCardRenewalPayment\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Service Payment\", key: \"servicePayment\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Visa Stamping\", key: \"visaStamping\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"2 Month Visiting Visa\", key: \"twoMonthVisitingVisa\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Fine Payment\", key: \"finePayment\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Entry Permit Outside\", key: \"entryPermitOutside\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Complaint Employee\", key: \"complaintEmployee\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Arabic Letter\", key: \"arabicLetter\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Violation Committee\", key: \"violationCommittee\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Quota Modification Others\", key: \"quotaModification\", width: 20, style: { numFmt: \"#,##0.00\" } },\r\n    { header: \"Total\", key: \"total\", width: 15, style: { numFmt: \"#,##0.00\" } },\r\n  ];\r\n\r\n  // Set the worksheet columns\r\n  worksheet.columns = columns;\r\n\r\n  // Add data rows\r\n  visaExpenses.forEach((expense) => {\r\n    const employee = expense.employee as any;\r\n    const rowData = {\r\n      name: `${employee.firstName} ${employee.lastName}`,\r\n      country: \"\", // You might want to add country to your User model\r\n      designation: employee.role,\r\n      bankNumber: \"\", // You might want to add bankNumber to your User model\r\n      iBan: expense.iBan,\r\n      passportNumber: expense.passportNumber,\r\n      passportExpireDate: expense.passportExpireDate,\r\n      emirateIdNumber: expense.emirateIdNumber,\r\n      emirateIdExpireDate: expense.emirateIdExpireDate,\r\n      labourCardPersonalNumber: expense.labourCardPersonalNumber,\r\n      workPermitNumber: expense.workPermitNumber,\r\n      labourExpireDate: expense.labourExpireDate,\r\n      offerLetterTyping: expense.offerLetterTyping,\r\n      labourInsurance: expense.labourInsurance,\r\n      labourCardPayment: expense.labourCardPayment,\r\n      statusChangeInOut: expense.statusChangeInOut,\r\n      insideEntry: expense.insideEntry,\r\n      medicalSharjah: expense.medicalSharjah,\r\n      tajweehSubmission: expense.tajweehSubmission,\r\n      iloeInsurance: expense.iloeInsurance,\r\n      healthInsurance: expense.healthInsurance,\r\n      emirateId: expense.emirateId,\r\n      residenceStamping: expense.residenceStamping,\r\n      srilankaCouncilHead: expense.srilankaCouncilHead,\r\n      upscoding: expense.upscoding,\r\n      labourFinePayment: expense.labourFinePayment,\r\n      labourCardRenewalPayment: expense.labourCardRenewalPayment,\r\n      servicePayment: expense.servicePayment,\r\n      visaStamping: expense.visaStamping,\r\n      twoMonthVisitingVisa: expense.twoMonthVisitingVisa,\r\n      finePayment: expense.finePayment,\r\n      entryPermitOutside: expense.entryPermitOutside,\r\n      complaintEmployee: expense.complaintEmployee,\r\n      arabicLetter: expense.arabicLetter,\r\n      violationCommittee: expense.violationCommittee,\r\n      quotaModification: expense.quotaModification,\r\n      total: expense.total,\r\n    };\r\n\r\n    worksheet.addRow(rowData);\r\n  });\r\n\r\n  // Style the header row\r\n  worksheet.getRow(1).eachCell((cell) => {\r\n    cell.font = { bold: true };\r\n    cell.fill = {\r\n      type: \"pattern\",\r\n      pattern: \"solid\",\r\n      fgColor: { argb: \"FFD3D3D3\" },\r\n    };\r\n    cell.border = {\r\n      top: { style: \"thin\" },\r\n      left: { style: \"thin\" },\r\n      bottom: { style: \"thin\" },\r\n      right: { style: \"thin\" },\r\n    };\r\n  });\r\n\r\n  // Freeze the header row\r\n  worksheet.views = [{ state: \"frozen\", ySplit: 1 }];\r\n\r\n  // Set response headers for Excel file download\r\n  res.setHeader(\r\n    \"Content-Type\",\r\n    \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\r\n  );\r\n  res.setHeader(\r\n    \"Content-Disposition\",\r\n    `attachment; filename=visa_expenses_export_${new Date().toISOString().split(\"T\")[0]}.xlsx`\r\n  );\r\n\r\n  // Write the workbook to the response\r\n  await workbook.xlsx.write(res);\r\n  res.end();\r\n});"]}